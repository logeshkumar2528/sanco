@using scfs_erp.Models;
@model scfs_erp.Models.TransactionMD
@{
    ViewBag.Title = "Export Manual Bill";
    Layout = "~/Views/Shared/Stuffing.cshtml";
}
<style>
    #TDETAIL {
    }

    /*#TDETAIL td input {
      width:50%;
    }*/

    .TRANDAID {
        min-width: 200px;
    }

    .TRANDREFNAME {
        min-width: 250px;
    }

    /*.TRANDREFNO {
        max-width: 100%;
    }*/

    .TDETAILBANK td {
        text-align: center;
    }

    .small {
        border: 0;
        width: 30px;
        max-width: 25%;
        background: none;
    }

    .stk {
        background: #0f367d;
        color: #fff;
    }

    .sm-1 {
        max-width: 50px;
    }

    .TRANGAMT, .TRANNAMT, .TRANROAMT {
        max-width: 150px;
    }

    .gross {
        min-width: 800px;
    }

    .frm_hide {
        display: none;
    }

    .small {
        border: 0;
        width: 30px;
        max-width: 25%;
        background: none;
    }

    .medium {
        border: 0;
        width: 50px;
        max-width: 55%;
        background: none;
    }
</style>
<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-search"></i>
                    <strong>ExportManualBill</strong>
                </div>
            </div>
            <div class="box-content" data-ng-app="myModule">
                <form action="@Url.Content("~/ExportManualBill/savedata")" method="post" accept-charset="utf-8" id="frm" data-ng-controller="myController" name="frm" onsubmit="return Validate()">
                    @Html.ValidationSummary(true)
                    <fieldset id="ExportCartingOrder_info">
                        <div class="row">
                            <div class="col-md-2 hidden">
                                <div class="form-group">
                                    <label>Primary  </label>
                                    @Html.TextBoxFor(model => model.masterdata[0].TRANMID, new { @class = "form-control  TRANMID", @id = "TRANMID" })
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Bill Type </label>
                                    @Html.DropDownList("TRANBTYPE", null, new { @class = "form-control TRANBTYPE", @id = "TRANBTYPE", tabindex = "1" })

                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Billed To</label>
                                    @Html.DropDownList("REGSTRID", null, new { @class = "form-control REGSTRID", @id = "REGSTRID", tabindex = "2" })
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>No</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNO, new { @class = "form-control  TRANNO", @id = "TRANNO", @readonly = "readonly" })
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Date/Time </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANTIME, new { @class = "form-control datetime  TRANTIME", @id = "TRANTIME", @data_val = false, @onblur = "test()", tabindex = "3" })
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>CHA  </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFNAME, new { @class = "form-control  TRANREFNAME", @id = "TRANREFNAME", data_autocomplete_url = Url.Action("AutoCha", "ExportManualBill"), placeholder = "Please Select CHA Name", tabindex = "5" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFID, new { @class = "hide form-control TRANREFID", @id = "TRANREFID" })

                                    <input type="text" value="" id="DDATE" class="hide form-control DDATE" name="DDATE" style="width:95px" />
                                </div>
                            </div>



                            <input type="text" id="pd_index" value="0" style="display:none">

                            <div style="float:right">
                            </div>
                            <div style="clear:both"> </div>
                        </div>


                        <div class="panel-heading navbar-inverse" style="color:white">Container Details<a class="navbar-right  btn-primary" id="add_detail" style="margin-top:-3px;"> <i class="glyphicon  glyphicon-plus-sign  well-sm"></i></a></div>

                        <input type="text" id="TDETAIL_IDX" value="0" name="TDETAIL_IDX[]" class="TDETAIL_IDX" style="display:none" />
                        <table class="table table-striped table-bordered bootstrap-datatable TDETAIL" id="TDETAIL">
                            <thead>
                                <tr>

                                    <th>
                                        Container No
                                    </th>
                                    <th>
                                        Size
                                    </th>
                                    <th>
                                        In Date
                                    </th>
                                    @*<th>
                                            Storage Date
                                        </th>
                                        <th>
                                            Charge Date
                                        </th>*@
                                    <th colspan='2' class='col-lg-2' style="text-align:center">
                                        Vehicle <br /><span class="pull-left">From</span> &nbsp;&nbsp;&nbsp;
                                        To
                                    </th>
                                    <th>
                                        Charge Description
                                    </th>
                                    <th>
                                        Amount
                                    </th>
                                    <th></th>

                                </tr>
                            </thead>

                            <tbody id="TDETAIL_BODY" class="TDETAIL_BODY">
                                @if (Model.detaildata != null)
                                {
                                    foreach (TransactionDetail details in Model.detaildata)
                                    {

                                        <tr class="item-row">

                                            <td class="hide">
                                                <input class="TRANDID" id="TRANDID" name="TRANDID" type="text" value="@details.TRANDID">
                                            </td>
                                            <td class="col-md-3">
                                                <input class="form-control TRANDREFNO" id="TRANDREFNO" name="TRANDREFNO" type="text" value="@details.TRANDREFNO">
                                            </td>
                                            <td class="col-md-2">
                                                @Html.DropDownListFor(model => model.detaildata[0].BILLEDID, new SelectList(ViewBag.BILLEDID, "value", "text", @details.BILLEDID), new { @class = "form-control BILLEDID", @id = "BILLEDID", @onchange = "GetCharge(this)" })
                                            </td>
                                            <td class="col-md-2">
                                                <input class="datepicker form-control TRANIDATE" id="TRANIDATE" name="TRANIDATE" type="text" value="@details.TRANIDATE.ToString("dd/MM/yyyy")">
                                            </td>

                                            <td class="col-md-2">
                                                <input class="form-control TRANVHLFROM" id="TRANVHLFROM" name="TRANVHLFROM" type="text" value="@details.TRANVHLFROM">
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANVHLTO form-control" id="TRANVHLTO" name="TRANVHLTO" type="text" value="@details.TRANVHLTO">
                                            </td>

                                            <td class="col-md-3">
                                                @Html.DropDownListFor(model => model.detaildata[0].TRANDREFID, new SelectList(ViewBag.TRANDREFID, "value", "text", @details.TRANDREFID), "Select", new { @class = "TRANDREFID", @id = "TRANDREFID", @onchange = "GetAmount(this)" })
                                                <input class="hide TRANDREFNAME" id="TRANDREFNAME" name="TRANDREFNAME" type="text" readonly value="@details.TRANDREFNAME">
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDGAMT" id="TRANDGAMT" name="TRANDGAMT" type="text" value="@details.TRANDGAMT" onchange="total()">
                                                <input class="hide TRANDNAMT" id="TRANDNAMT" name="TRANDNAMT" type="text" readonly value="@details.TRANDNAMT">
                                            </td>
                                            <td><a class="" id="del_detail"> <i class="glyphicon glyphicon-trash" style="color:#ff0000;font-size:large"></i></a></td>
                                        </tr>
}
                                }
                                else
                                {
                                    <tr class="item-row">

                                        <td class="hide">
                                            <input class="TRANDID" id="TRANDID" name="TRANDID" type="text" value="0">
                                        </td>
                                        <td class="col-md-3">
                                            <input class="form-control TRANDREFNO" id="TRANDREFNO" name="TRANDREFNO" type="text">
                                        </td>
                                        <td class="col-md-2">
                                            @Html.DropDownListFor(model => model.detaildata[0].BILLEDID, new SelectList(ViewBag.BILLEDID, "value", "text"), new { @class = "form-control BILLEDID", @id = "BILLEDID", @onchange = "GetCharge(this)" })
                                        </td>
                                        <td class="col-md-2">
                                            <input class="datepicker form-control TRANIDATE" id="TRANIDATE" name="TRANIDATE" type="text" value="">
                                        </td>

                                        <td class="col-md-2">
                                            <input class="form-control TRANVHLFROM" id="TRANVHLFROM" name="TRANVHLFROM" type="text">
                                        </td>
                                        <td class="col-md-2">
                                            <input class="TRANVHLTO form-control" id="TRANVHLTO" name="TRANVHLTO" type="text">
                                        </td>

                                        <td class="col-md-3">
                                            @Html.DropDownListFor(model => model.detaildata[0].TRANDREFID, new SelectList(ViewBag.TRANDREFID, "value", "text"), "Select", new { @class = "TRANDREFID", @id = "TRANDREFID", @onchange = "GetAmount(this)" })
                                            <input class="TRANDREFNAME hide" id="TRANDREFNAME" name="TRANDREFNAME" type="text" readonly>
                                        </td>
                                        <td class="col-md-2">
                                            <input class="TRANDGAMT" id="TRANDGAMT" name="TRANDGAMT" type="text" onchange="total()">
                                            <input class="TRANDNAMT hide" id="TRANDNAMT" name="TRANDNAMT" type="text" readonly>
                                        </td>
                                        <td><a class="" id="del_detail"> <i class="glyphicon glyphicon-trash" style="color:#ff0000;font-size:large"></i></a></td>
                                    </tr>
                                }
                            </tbody>
                        </table>




                        <table class='table table-striped table-bordered bootstrap-datatable'>
                            <tr>
                                <td><a href='#' id='cfact' class='btn btn-success btn-xs'><i class=glyphicon-plus></i> Tax</a>  </td>
                                <td align='right' colspan='4' class="gross">  Gross Amount </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANGAMT, new { @class = "form-control  TRANGAMT", @id = "TRANGAMT", @readonly = true })
                                </td>

                            </tr>

                            <tr>

                                <td colspan="6" class="cf_dynamic ">

                                    <table class='table table-striped table-bordered bootstrap-datatable' id='CFACTOR' style="padding:0;margin:0">
                                        <tr> <td> </td> <td>Cost Factror</td> <td colspan='3' class='col-lg-0'>Expression  & Nos </td> <td class='col-lg-0'>Mode</td> <td> </td> </tr>

                                        @if (Model.costfactor != null)
                                        {

                                            string exp = "";
                                            string mod = "";
                                            foreach (TransactionMasterFactor cfdetails in Model.costfactor)
                                            {
                                                exp = "";
                                                mod = "";



                                                if (cfdetails.DEDTYPE == 0)
                                                { exp = "selected"; }
                                                if (cfdetails.DEDMODE != "0")
                                                { mod = "selected"; }

                                                <tr>
                                                    <td> <button type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </td>
                                                    <td>
                                                        <input type=text name='TAX' id=TAX style='display:none' class=TAX value="@cfdetails.CFID">
                                                        @cfdetails.DEDCFDESC
                                                        <input type=text name=CFDESC id=CFDESC class='CFDESC hide' value="@cfdetails.DEDCFDESC" onchange='total()'>
                                                    </td>
                                                    <td class='col-lg-1'><select id=CFTYPE name=CFTYPE class=CFTYPE onchange='total()'><option value='1'> %</option><option value='0' @exp>Value </option> </select></td>
                                                    <td class='col-lg-1'><input type=text id=DEDNOS name=DEDNOS class='DEDNOS' style="width:55px" value="@cfdetails.DEDNOS" onchange=' total()'></td>
                                                    <td class='col-lg-1'><input type=text id=CFEXPR name=CFEXPR class=CFEXPR value="@cfdetails.DEDEXPRN" onchange='total()'>   </td>
                                                    <td><select id=CFMODE name=CFMODE class=CFMODE onchange='total()'><option value='0'>+</option><option value='1' @mod>-</option> </select><input type=text id=DORDRID name=DORDRID style='display:none' class=DORDRID value="@cfdetails.DORDRID" onchange='total() '></td>
                                                    <td class="col-lg-0"><input type=text readonly="readonly" value="@cfdetails.DEDVALUE" name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT col-lg-0' onchange='total()'> <input style='display:none' type=text value="@cfdetails.TRANMFID" name=TRANMFID id='TRANMFID' class='TRANMFID'>  </td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <td></td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input type=text name=CFDESC id='CFDESC' class='CFDESC' value='' style="border:none" readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input style="border:none" type=text name=CFDESC id='CFDESC' class='CFDESC' value='' readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>

                                            <tr id="TMP_KKC" class="frm_hide">
                                                <td></td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input style="border:none" type=text name=CFDESC id='CFDESC' class='CFDESC' value='' readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>
                                        }

                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> Rounding Off </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANROAMT, new { @class = "form-control  TRANROAMT ", @id = "TRANROAMT", @readonly = true })
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> Net Amount </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNAMT, new { @class = "form-control  TRANNAMT ", @id = "TRANNAMT", @readonly = true })
                                </td>
                            </tr>
                        </table>



                        <fieldset style="width:100%">
                            <legend style="font-size:large">Bank Details</legend>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Mode</label>
                                    <br />
                                    @Html.DropDownList("TRANMODE", null, "Select", new { @class = "form-control TRANMODE", @id = "TRANMODE", @onchange = "ModeChange()", tabindex = "5000" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANMODEDETL, new { @class = "hide form-control  TRANMODEDETL", @id = "TRANMODEDETL" })


                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Number</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFNO, new { @class = "form-control  TRANREFNO", @id = "TRANREFNO", tabindex = "5001" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Date</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFDATE, "{0:dd/MM/yyyy}", new { @class = "form-control  datepicker TRANREFDATE", @id = "TRANREFDATE", @data_val = false, tabindex = "5002" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Amount</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFAMT, new { @class = "form-control  TRANREFAMT", @id = "TRANREFAMT", tabindex = "5003" })
                                </div>
                            </div>
                            <div class=" col-md-4">
                                <div class="form-group">
                                    <label>Bank</label>
                                    @Html.DropDownList("BANKMID", null, "Please Select an Option", new { @class = "form-control BANKMID", @id = "BANKMID", tabindex = "5004" })

                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFBNAME, new { @class = "hide form-control  TRANREFBNAME", @id = "TRANREFBNAME" })
                                </div>
                            </div>
                            <div class=" col-md-8">
                                <div class="form-group">
                                    <label>Remarks</label>
                                    @Html.TextAreaFor(model => Model.masterdata[0].TRANRMKS, 4, 8, new { @class = "form-control  TRANRMKS", @id = "TRANRMKS", tabindex = "5005" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Status </label>
                                    @Html.DropDownList("DISPSTATUS", null, new { @class = "form-control DISPSTATUS", @id = "DISPSTATUS", tabindex = "5006" })


                                </div>
                            </div>

                        </fieldset>


                        <div class="col-md-12 box-footer">
                            <input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs  pull-left" onclick="JavaScript:history.back()" />
                            <input type="button" name="submit2" value="Save as Estimate" class="btn btn-warning btn-xs hidden " hidden />
                            <input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs  " id="save" tabindex="5011" />

                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>
@section Scripts {

    <script type="text/javascript">
        $(document).ready(function () {
            window.onbeforeunload = function () {
                $("input[type=submit]").attr("disabled", "disabled");
            };
            var rowcount = $('#TDETAIL tbody tr').length;
            $("#TDETAIL_IDX").val(rowcount);

            //----------------------------------insert/delete row-----------------------------------------//

            $("#add_detail").click(function () {

                if ($("#TDETAIL_IDX").val() != 0) {


                    var $tableBody = $('#TDETAIL').find("tbody"),
                    $trLast = $tableBody.find("tr:last");
                    $trNew = $trLast.clone();
                    $trLast.after($trNew);
                  //  $trNew.find("td:eq(2)").html("<select id='GIDID' class='GIDID form-control' name='GIDID' onchange='test(this)' tabindex=500><option>Select</option> </select>  ");
                    $trNew.find('input:text').val("");
                    $trNew.find('#TRANDID').val("0");
                    //event bind
                    //      $trNew.find(".GIDID").on("click", function () {
                    $trNew.find('.datepicker').each(function () {
                        $(this).removeAttr('id').removeClass('hasDatepicker'); // added the removeClass part.
                        $('.datepicker').datepicker({ dateFormat: 'dd/mm/yy' });
                    });

                    var row_idx = parseInt($("#TDETAIL_IDX").val());

                    $("#TDETAIL_IDX").val(row_idx + 1);

                    $("#TDETAIL_BODY").show();
                    total();

                }
                else {

                    $('#TDETAIL_IDX').val("1");
                    $("#TDETAIL_BODY").show();
                    total();
                }
            });

            //delete event


            $(document).on("click", "#del_detail", function () {

                var r = confirm("Are you sure to delete this record ?");

                if (r == true) {


                    //  idx = $(this).parent().parent().index();
                    idx = $("#TDETAIL_IDX").val();

                    if (idx == 1) {

                        $("#TDETAIL_BODY").hide();

                        $("#TDETAIL_IDX").val(0);


                        var $tableBody = $('#TDETAIL').find("tbody")

                        $trCur = $tableBody.find("tr:eq(0)");
                        $trCur.find('input:text').val("");
                        $trCur.find('#TRANDID').val("0");

                        total();

                    }
                    else {
                        $("#TDETAIL_BODY").show();
                        var row = this.parentNode.parentNode;
                        $(this).parents('.item-row').remove();

                        $("#TDETAIL_IDX").val($("#TDETAIL_IDX").val() - 1);
                        total();
                    }
                }
            });

        });

        $(document).ready(function () {


            stuffing_autocomplete($("#TRANREFNAME"), "TRANREFNAME,TRANREFID");//---AUTOCOMPLETE FUNCTION FOR GET DETAIL GRID-----

            //-----date controls-------------
            $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', });
            $('.datetime').datetimepicker({
                dateFormat: 'dd/mm/yy',
                timeFormat: 'hh:mm'
            });
            //$('.time').timepicker();

            if ($("#TRANMID").val() == 0) {
                var dt = new Date();
                var month = dt.getMonth() + 1;
                var date = dt.getDate() + "/" + month + "/" + dt.getFullYear();
                var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
                var datetme = time;
                $(".TRANTIME").val(date + " " + datetme);
            }
            //...End of date contrl..
            ModeChange();
            //.......GET BANK NAME FROM DROPDOWN VALUE ...........
            $("#BANKMID").change(function () {
                var TRANREFBNAME = $(".BANKMID option:selected").text();
                $(".TRANREFBNAME").val(TRANREFBNAME);
            });
            //...END


        });

        //......end
        //.......................TRANMODE change event..................//

        function ModeChange() {
            var modeval = $("#TRANMODE").val();
            if ($("#TRANMID").val() == "0") {
                var TRANMODEVAL = $("#TRANMODE option:selected").text();
                $(".TRANMODEDETL").val(TRANMODEVAL);
                $("#TRANREFNO").val("");
                $("#TRANREFDATE").val("");
                $("#BANKMID").val("");
            }
            if (modeval != 2 && modeval != 3) {
                $("#TRANREFNO").attr('disabled', true);
                $("#TRANREFDATE").attr('disabled', true);
                $("#BANKMID").attr('disabled', true);
            }
            else {
                $("#TRANREFNO").attr('disabled', false);
                $("#TRANREFDATE").attr('disabled', false);
                $("#BANKMID").attr('disabled', false);
            }
        }
        //.............End



        //...............Window bind..........................//

        $(window).bind("load", function () {
            if ($(".TRANMID").val() == "") {
                $(".TRANMID").val("0");
            }
            if ($(".TRANDID").val() == "") {
                $(".TRANDID").val("0");
            }




            count = 500;
            $('.TRANDID').each(function (k) {

                $("#TDETAIL input:text,#TDETAIL select").attr('tabindex', count++);
            });

            txcount = 1000;
            $('.TAX').each(function (k) {

                $("#CFACTOR input:text,#CFACTOR select,#CFACTOR a").attr('tabindex', txcount++);
            });
            //..........Displaying Cost Factor insert mode....//
            if ($(".TRANMID").val() == 0) {
                base = window.location.origin;
                var $tableBody = $('#CFACTOR').find("tbody"),
                 $trLast = $tableBody.find("tr:last");
                $.ajax({
                    url: base + "/ExportManualBill/DefaultCF",
                    type: "POST",

                    success: function (data, textStatus, jqXHR) {
                        //data - response from server
                        // alert(data);

                        for (var i = 0; i < data.length; i++) {
                            //  alert(data.length + "........" + data[i].CFEXPR + "..." + data[i].CFID + "...." + data[i].CFDESC);

                            $(".TAX")[i].value = data[i].CFID;
                            $(".CFDESC")[i].value = data[i].CFDESC;
                            $(".CFEXPR")[i].value = data[i].CFEXPR;
                            $(".CFTYPE")[i].value = data[i].CFTYPE;
                            $(".CFMODE")[i].value = data[i].CFMODE;
                            $(".DORDRID")[i].value = data[i].DORDRID;
                        }

                        if (data[2].DISPSTATUS == 1) {
                            $("#TMP_KKC").addClass("frm_hide");
                        } else {
                            $("#TMP_KKC").removeClass("frm_hide");
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                });
                ModeChange();
            }//....................end




        });//.......end of bind


        //..................FUNCTION TO GET DETAIL GRID..............

        function stuffing_autocomplete($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };
            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break;
                        }
                        count++
                    });

                    return false;
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }////......end

        //........DATE DIFFERENCE.....................
        function datdidff(start_date, end_date) {
            //start_date = start_date.split("/");
            //end_date = end_date.split("/");

            if (start_date.match("/")) { start_date = start_date.split("/"); }
            else if (start_date.match("-")) { start_date = start_date.split("-"); }

            if (end_date.match("/")) { end_date = end_date.split("/"); }
            else if (end_date.match("-")) { end_date = end_date.split("-"); }
            start_date = start_date[2] + "-" + start_date[1] + "-" + start_date[0];
            end_date = end_date[2] + "-" + end_date[1] + "-" + end_date[0];

            var diff = Math.floor((Date.parse(end_date.replace(/-/g, '\/')) - Date.parse(start_date.replace(/-/g, '\/'))) / 86400000);

            return diff;

        }//......end

        function sel_text(obj, dest) {
            row = obj.parentNode.parentNode.rowIndex;
            var modelLength = obj.options[obj.selectedIndex].text;
            $("." + dest)[row - 1].value = modelLength;
            var selid = '/Common/CostFactorDetail/' + obj.value;
            $.getJSON(selid, function (data) {
                var items = [];
                $.each(data, function (key, val) {
                    $(".CFMODE")[row - 1].value = val.CFMODE;
                    $(".CFEXPR")[row - 1].value = val.CFEXPR;
                    $(".CFTYPE")[row - 1].value = val.CFTYPE;
                    $(".DORDRID")[row - 1].value = val.DORDRID;
                    $(".DEDORDR")[row - 1].value = val.CFNATR;
                });
                total();
            });
        }
        function del_factor(obj) {
            row = obj.parentNode.parentNode.rowIndex;
            document.getElementById("CFACTOR").deleteRow(row);
            total();
            return false;

        }
        function total() {

            TRANNAMT = 0; TRANDNAMT = 0;
            TRANGAMT = 0;
            CF_ROW_TOTAL = 0;
            i = 0;
            TRANDGAMT = 0;
            TRANROAMT = 0;
            var total = 0; var gamt = 0.00; var namt = 0.00;

            count = 0;
            i = 0; //$("#TRANGAMT").val("0");
            $(".TRANDID").each(function () {


                TRANDNAMT = $(".TRANDNAMT")[i].value;
                TRANDGAMT = $(".TRANDGAMT")[i].value;

                if (isNaN(TRANDGAMT) || TRANDGAMT == "") { TRANDGAMT = 0; $(".TRANDGAMT")[i].value = 0 }
                else
                    TRANDGAMT = eval(TRANDGAMT).toFixed(2);

                if (isNaN(TRANDNAMT) || TRANDNAMT == "") { TRANDNAMT = 0; $(".TRANDNAMT")[i].value = 0 }
                else
                    TRANDNAMT = eval(TRANDNAMT).toFixed(2);

                 $(".TRANDNAMT")[i].value = eval(TRANDNAMT).toFixed(2);
                 $(".TRANDGAMT")[i].value = eval(TRANDGAMT).toFixed(2);
                 gamt = gamt + eval($(".TRANDGAMT")[i].value);
                 namt = namt + eval($(".TRANDNAMT")[i].value);

                i++;
            });
            $("#TRANGAMT").val(gamt.toFixed(2));
            $("#TRANNAMT").val(namt.toFixed(2));
            $("#TRANREFAMT").val($("#TRANNAMT").val());
            TRANGAMT = $("#TRANGAMT").val();
            var round = 0.00; i = 0; NETGAMT = 0;
            $('.TAX').each(function () {

                //$(".DEDNOS")[i].value = count;
                temp = 0;
                temp_tax = TRANGAMT;
                if (i > 0)
                    temp_tax = eval(TRANGAMT) + eval(CF_ROW_TOTAL);
                // alert("1");

                //switch ($(".DEDORDR")[i].value) {/*inclusiv/exclusiv*/
                //    case "0": temp_tax = temp_tax; break;
                //    case "1": temp_tax = 0;

                //}

                //  alert("2call");

                //if ($(".CFTYPE")[i].value == 1)
                //    temp = eval(temp_tax) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100;
                //else
                //    temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)).toFixed(2);




                //switch ($(".DORDRID")[i].value) {
                //    case "4":

                //        if (i < 1) {
                //            temp = 0;
                //            alert("1.Correct Excise Order");

                //            break;

                //        }
                //        ex = $(".DORDRID")[i - 1].value;
                //        ex = ex.trim();

                //        if ($(".CFTYPE")[i].value != 0)
                //            temp = eval($(".CFAMOUNT")[i].value) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100;
                //        else
                //            temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value));


                //        if (ex != "3") {
                //            temp = 0;
                //            alert("2.Correct Excise Order");
                //        }

                //        break;
                //    case "5":

                //        if (i < 2) {
                //            temp = 0;
                //            alert("3.Correct Excise Order");
                //            break;

                //        }

                //        ex = $(".DORDRID")[i - 2].value;
                //        ex = ex.trim();

                //        sec = $(".DORDRID")[i - 1].value;
                //        sec = ex.trim();


                //        if ($(".CFTYPE")[i].value != 0)
                //            temp = eval($(".CFAMOUNT")[i].value) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100;
                //        else
                //            temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value));


                //        if (ex != "3" && sec != "4") {
                //            temp = 0;
                //            alert("4.Correct Excise Order");
                //        }



                //        break;
                //}





                if (isNaN(temp))
                    temp = 0;





                switch ($(".TAX")[i].value) {
                    case "2": {
                        NETGAMT = eval(temp_tax);
                        //  alert("case2" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);

                        if ($(".CFTYPE")[i].value == 1)
                        { $(".DEDNOS")[i].value = 1; temp = eval(temp_tax) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100; }
                        else
                        { $(".DEDNOS")[i].value = count; temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)).toFixed(2); }


                        break;
                    }
                    case "96": {
                        //  alert("case93" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);

                        if ($(".CFTYPE")[i].value == 1)
                        { $(".DEDNOS")[i].value = 1; temp = Math.round(eval(NETGAMT) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100); }
                        else
                        {
                            $(".DEDNOS")[i].value = count; temp = Math.round(eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value))).toFixed(2);

                        }


                        break;
                    }
                    case "97": {
                        //  alert("case93" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);

                        if ($(".CFTYPE")[i].value == 1)
                        { $(".DEDNOS")[i].value = 1; temp = Math.round(eval(NETGAMT) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100); }
                        else
                        {
                            $(".DEDNOS")[i].value = count; temp = Math.round(eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value))).toFixed(2);

                        }


                        break;
                    }
                    default: {
                        //  alert("def" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);
                        //NETGAMT = eval(NETGAMT) + eval(CF_ROW_TOTAL);
                        if ($(".CFTYPE")[i].value == 1)
                        { $(".DEDNOS")[i].value = 1; temp = eval(temp_tax) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100; }
                        else
                        { $(".DEDNOS")[i].value = count; temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)).toFixed(2); }


                        break;
                    }
                }
                if ($(".CFMODE")[i].value == 0)
                    CF_ROW_TOTAL = Math.round(eval(CF_ROW_TOTAL) + eval(temp));
                else
                    CF_ROW_TOTAL = Math.round(eval(CF_ROW_TOTAL) - eval(temp));

                if (isNaN(temp)) temp == "0";
                $(".CFAMOUNT")[i].value = Math.round(eval(temp)).toFixed(2);



                i++;
            });
            round = (eval(TRANGAMT) + eval(CF_ROW_TOTAL));

            ROCHECK = Math.abs(Math.round(round, 0) - parseFloat(round)).toFixed(2);
            if (isNaN(ROCHECK))
                ROCHECK = 0;


            $('.TRANROAMT').val(ROCHECK);
            TRANROAMT = Math.round(round, 0) - parseFloat(round);

            TRANNAMT = (eval(TRANGAMT) + eval(CF_ROW_TOTAL) + eval(TRANROAMT)).toFixed(2);

            if (isNaN(TRANNAMT))
                TRANNAMT = 0;

            $("#TRANNAMT").val(TRANNAMT);
            $("#TRANREFAMT").val(TRANNAMT);
        }


        $(document).ready(function () {

            function sleep(milliseconds) {
                var start = new Date().getTime();
                for (var i = 0; i < 1e7; i++) {
                    if ((new Date().getTime() - start) > milliseconds) {
                        break;
                    }
                }
            }



            $(document).on("click", "#cfact", function () {


                var $tableBody = $('#CFACTOR').find("tbody"),
        $trLast = $tableBody.find("tr:last");
                $trFirst = $tableBody.find("tr:first");

                $("#cf_dynamic").css("display:block");


                var tax_param = "";
                i = 0;


                $('.TAX').each(function () {

                    tax_param = tax_param + $.trim(this.value) + ",";
                    pos = $('#CFACTOR tr').eq(($('#CFACTOR tr').length - ($('#CFACTOR tr').length)) + 1);
                    idx = $('#CFACTOR tr').length - 2;
                    desc = pos.find(".CFDESC").val();
                    tax = pos.find(".TAX").val();

                    pos.find('td:eq(1)').html("<input type=text value=" + tax + " id='TAX' class='TAX' name='TAX' style='display:none' >" + desc + "<input type=text style='border:none' readonly=readonly value='" + desc + "' name=CFDESC id='CFDESC' class='CFDESC hide'> ");

                    i++;
                });



                var formData = { term: tax_param }; //Array

                $.ajax({
                    url: "/Common/CostFactor",
                    type: "POST",
                    data: formData,
                    success: function (data, textStatus, jqXHR) {
                        //data - response from server

                        if (data.length != 0)
                            $trFirst.after("<tr class='item-row'><Td> <button href='#'   type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </td> <td>" + data + " </td><td><input  type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>  </TD></tr>");


                        total();


                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                });

                total();
                return false;

            });

        });


        //..................... FORM VALIDATION FUNCTION.................................//
        function Validate() {

            if ($(".TRANREFNAME").val() == "") {
                alert("Please select CHA");
                $(".TRANREFNAME").focus();
                return false;
            }
            else if ($(".TRANREFID").val() == "") {
                alert("Please Select CHA properly");
                $(".TRANREFNAME").val("");
                $(".TRANREFNAME").focus();
                return false;
            }
            else if ($("#TRANMODE").val() == "") {

                alert("Please Select Payment Mode");
                $("#TRANMODE").focus();
                return false;
            }
            else if ($(".TRANMODEDETL").val() == "") {
                alert("Select Payment Mode properly");
                $(".TRANMODEDETL").focus();
                return false;
            }
            else if ($("#TRANMODE").val() == "2" || $("#TRANMODE").val() == "3") {
                if ($("#TRANREFNO").val() == "") {
                    alert("Please Enter Number");
                    $("#TRANREFNO").focus();
                    return false;
                }
                if ($("#TRANREFDATE").val() == "") {
                    alert("Please Enter Date");
                    $("#TRANREFDATE").focus();
                    return false;
                }
                if ($(".TRANREFBNAME").val() == "") {
                    alert("Select Bank Name Properly");
                    $(".BANKMID").focus();
                    return false;

                }
            }
            else if ($(".TRANREFAMT").val() == "") {
                alert("Please Enter Amount");
                $(".TRANREFAMT").focus();
                return false;
            }

            var bad = 0;
            $('#TDETAIL :text,#TDETAIL select').each(function () {
                // alert(this.id);
                switch (this.id) {
                    default:
                        if ($.trim(this.value) == "") { bad++;  }
                }
            });

            if (bad < 1)
                return true;
            else {

                alert("Please Enter Container details before save");
                return false;
            }


        }//.....END OF VALIDATION


        /*...............*/

        function GetCharge(obj) {
            row = obj.parentNode.parentNode.rowIndex;
            row = row - 1;
            var $tableBody = $('#TDETAIL').find("tbody")
            $trCur = $tableBody.find("tr:eq(" + row + ")");

            $trCur.find(".TRANDREFID").empty(); $trCur.find(".TRANDREFNAME").val(""); $trCur.find(".TRANDGAMT").val("0.00"); $trCur.find(".TRANDNAMT").val("0.00");
            id = $trCur.find(".BILLEDID option:selected").val();
            $.ajax({
                type: 'get',
                url: '@Url.Action("GetCharge", "ExportManualBill")/' + id, // we are calling json method
                dataType: 'json',
                success: function (data) {
                   // if (data != "") {
                        $trCur.find(".TRANDREFID").append('<option value="">Select </option>');
                        $.each(data, function (i, dataval) {
                            $trCur.find(".TRANDREFID").append('<option value="' + dataval.CHRGID + '">' + dataval.CHRGDESC + '</option>');

                        });
                  //  }
                        total();
                },
                error: function (ex) {
                    alert('Failed to data ' + ex);
                }
            });
            return false;


        }/*.....*/
        function GetAmount(obj) {
            row = obj.parentNode.parentNode.rowIndex;
            row = row - 1;
            var $tableBody = $('#TDETAIL').find("tbody")
            $trCur = $tableBody.find("tr:eq(" + row + ")");


            id = $trCur.find(".TRANDREFID option:selected").val();
            $.ajax({
                type: 'get',
                url: '@Url.Action("GetAmount", "ExportManualBill")/' + id, // we are calling json method
                dataType: 'json',
                success: function (data) {
                    if (data != "") {
                        $trCur.find(".TRANDGAMT").val(data[0].CHRGAMT);
                        $trCur.find(".TRANDNAMT").val(data[0].CHRGAMT);
                        $trCur.find(".TRANDREFNAME").val(data[0].CHRGDESC);
                    }
                    total();
                },
                error: function (ex) {
                    alert('Failed to data ' + ex);
                }
            });
            return false;


        }/*.....*/
    </script>
}
