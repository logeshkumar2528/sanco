@using scfs_erp.Models;
@model scfs_erp.Models.TransactionMaster

@{
    Layout = "~/Views/Shared/_PopupLayout.cshtml";
}

<style>
    .frm_hide {
        display: none;
    }

    .ui-autocomplete {
        position: absolute;
        cursor: default;
        z-index: 4000 !important;
    }
</style>
<div class="modal-dialog">
    <div class="modal-content">
        <form id="InvoicePrint" method="post" action="@Url.Action("PrintView","StuffingBill")" autocomplete="on">
            <div class="modal-header">
                @*<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>*@
                <h4 class="modal-title">Stuffing Bill Print</h4>
            </div>
            <div class="modal-body">
                <input type="text" id="FTRANMID" class="FTRANMID hide form-control" name="FTRANMID" value="@ViewBag.id">
                <input type="text" id="FGSTAMT" class="FGSTAMT hide form-control" name="FGSTAMT" value="@ViewBag.FGSTAMT" readonly="readonly">


                <div class="form-group col-lg-12">
                    <label>Name</label>
                    <input type="text" id="TRANNAME" class="TRANCSNAME  form-control" name="TRANCSNAME" value="@ViewBag.TRANCSNAME" data-autocomplete-url=@Url.Action("AutoCha", "NonPnrInvoice") readonly="readonly">
                    <input type="text" id="TRANCSNAME" class="TRANCSNAME  form-control" name="TRANCSNAME" value="@ViewBag.TRANCSNAME" data-autocomplete-url=@Url.Action("AutoCha", "NonPnrInvoice") readonly="readonly">
                    <input type="text" id="TRANBILLREFID" class="TRANBILLREFID hide form-control" name="TRANBILLREFID" value="@ViewBag.TRANBILLREFID">
                    @*@Html.TextBoxFor(model => Model.TRANCSNAME, new { @class = "form-control TRANCSNAME", @id = "TRANCSNAME", data_autocomplete_url = @Url.Action("AutoCha", "EmptyVehicleTicket"), @required = true, placeholder = "Please Choose", @maxlength = "100" })
                        @Html.TextBoxFor(model => Model.TRANBILLREFID, new { @class = "form-control TRANREFID", @id = "TRANREFID", })*@
                </div>


                <div class="form-group col-lg-6">
                    <label>Address Line1</label>
                    <input type="text" id="TRANIMPADDR1" class="TRANIMPADDR1  form-control" name="TRANIMPADDR1" value="@ViewBag.TRANIMPADDR1" readonly="readonly">
                </div>

                <div class="form-group col-lg-6">
                    <label>Address Line2</label>
                    <input type="text" id="TRANIMPADDR2" class="TRANIMPADDR2  form-control" name="TRANIMPADDR2" value="@ViewBag.TRANIMPADDR2" readonly="readonly">
                </div>

                <div class="form-group col-lg-6">
                    <label>Address Line3</label>
                    <input type="text" id="TRANIMPADDR3" class="TRANIMPADDR3  form-control" name="TRANIMPADDR3" value="@ViewBag.TRANIMPADDR3" readonly="readonly">
                </div>



                <div class="form-group col-lg-6">
                    <label>Address Line4</label>
                    <input type="text" id="TRANIMPADDR4" class="TRANIMPADDR4  form-control" name="TRANIMPADDR4" value="@ViewBag.TRANIMPADDR4" readonly="readonly">
                </div>
                <div class="form-group col-lg-6">
                    <label>E-Mail</label>
                    <input type="text" id="CATEMAIL" class="CATEMAIL  form-control" name="CATEMAIL" value="@ViewBag.CATEMAIL">
                </div>
                <div class="form-group col-lg-6">
                    <label>Mobile</label>
                    <input type="text" id="CATEPHN1" class="CATEPHN1  form-control" name="CATEPHN1" value="@ViewBag.CATEPHN1">
                </div>
                <div class="form-group col-lg-6">
                    <label>GS TIN No.</label>
                    <input type="text" id="GSTNO" class="GSTNO  form-control" name="GSTNO" value="@ViewBag.GSTNO" readonly="readonly">
                </div>

                <div class="form-group col-lg-5 hidden">
                    <label>Select Type</label>
                    <input type="radio" name="rpttype" value="0" onchange="GetVal()" checked>Detail&nbsp;&nbsp;&nbsp;<input type="radio" name="rpttype" value="1" onchange="GetgrpVal()">Group
                    <input type="text" id="rpttype_f" class="rpttype_f  form-control hidden" name="rpttype_f" value="0">
                </div>

                <div class="form-group col-lg-5 hide">
                    <label>Billed to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <input type="radio" name="brpttype" value="0" onchange="GetBillVal()" checked>CHA&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="brpttype" value="1" onchange="GetBillgrpVal()">Importer
                    <input type="text" id="brpttype_f" class="brpttype_f  form-control hidden" name="brpttype_f" value="0">
                </div>

                <div class="form-group col-lg-7">
                    @*<input type="text" class="form-control" id="Tmp_handling" name="Tmp_handling" value="Handling Charges including PNR movement" />*@
                    <input type="text" class="Tmp_handling form-control" id="Tmp_handling" name="Tmp_handling" value="Stuffing Charges" onkeypress="return IsAlphaNumeric(event);" ondrop="return false;" onpaste="return false;" />
                </div>
                <div class="clearfix"> </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" onclick="closemodel();" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="Print">Print</button>
                </div>
            </div>

        </form>
    </div>
</div>



<script>

    $(document).ready(function () {
        //  add_autocomplete($("#IMPRTNAME"), "IMPRTNAME,IMPRTID");//---AutoComplete function for IMPORTER-----
        add_autocomplete($("#TRANCSNAME"), "TRANCSNAME,TRANBILLREFID");//---AutoComplete function for CHANAME-----


    });



    function stuffing_autocomplete($obj, controls) {
        var oldFn = $.ui.autocomplete.prototype._renderItem;
        $.ui.autocomplete.prototype._renderItem = function (ul, item) {
            var re = new RegExp(this.term, "i");
            var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
            return $("<li></li>")
                .data("item.autocomplete", item)
                .append("<a>" + t + "</a>")
                .appendTo(ul);
        };
        $obj.autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: $obj.data("autocomplete-url"),
                    type: "POST",
                    dataType: "json",
                    data: {
                        term: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            count = 0;
                            item_str = "";
                            var jsonArg = new Object();
                            count = 0;
                            $.each(item, function (i, data) {
                                switch (count) {
                                    case 0:
                                        jsonArg.label = data;
                                        jsonArg.value = data;
                                        break;
                                    case 1:
                                        jsonArg.id = data;
                                        break;
                                    case 2:
                                        jsonArg.desc = data;
                                        break;
                                    case 3:
                                        jsonArg.xparam1 = data;
                                        break;
                                    case 4:
                                        jsonArg.xparam2 = data;
                                        break;
                                    case 5:
                                        jsonArg.xparam3 = data;
                                        break
                                }
                                count++
                            });
                            return jsonArg
                        }))
                    }
                })
            },
            search: function () {
                var term = extractLast(this.value);
                if (term.length < 2) {
                    return false
                }
            },
            select: function (event, ui) {
                $(this).val(ui.item.label);
                count = 0;
                $.each(controls.split(','), function (index, value) {
                    switch (count) {
                        case 1:
                            $("#" + value).val(ui.item.id);
                            break;
                        case 2:
                            $("#" + value).val(ui.item.desc);
                            break;
                        case 3:
                            $("#" + value).val(ui.item.xparam1);
                            break;
                        case 4:
                            $("#" + value).val(ui.item.xparam2);
                            break;
                        case 5:
                            $("#" + value).val(ui.item.xparam3);
                            break;
                    }
                    count++
                });

                return false;
            },
            messages: {
                noResults: "",
                results: ""
            }
        })
    }////......end


    function GetVal() {
        $(".rpttype_f").val("0");
    }

    function GetBillVal() {
        $(".brpttype_f").val("0");
        $('#TRANBILLREFID').hide();
        url = '@Url.Action("AFormAddr", "StuffingBill")/' + $(".FTRANMID").val() + '~' + '0';

        $.ajax({
            type: 'post',
            url: url, // we are calling json method
            //  data: $("#InvoicePrint").serialize(),

            success: function (data) {

                if (data.length != 0) {
                    $(".TRANCSNAME").val(data[0].TRANCSNAME);
                    $(".TRANIMPADDR1").val(data[0].TRANIMPADDR1);
                    $(".TRANIMPADDR2").val(data[0].TRANIMPADDR2);
                    $(".TRANIMPADDR3").val(data[0].TRANIMPADDR3);
                    $(".TRANIMPADDR4").val(data[0].TRANIMPADDR4);
                    $(".GSTNO").val(data[0].CHACATEGSTNO);
                }
                else {
                    $("#TRANCSNAME").val("");
                    $("#TRANIMPADDR1").val("");
                    $("#TRANIMPADDR2").val("");
                    $("#TRANIMPADDR3").val("");
                    $("#TRANIMPADDR4").val("");
                    $(".GSTNO").val("");
                }


            }
        })

    }

    function GetgrpVal() {
        $(".rpttype_f").val("1");
    }

    function GetBillgrpVal() {
        $(".brpttype_f").val("1");
        $('#TRANBILLREFID').show();
        url = '@Url.Action("AFormAddr", "StuffingBill")/' + $(".FTRANMID").val() + '~' + '1';

        $.ajax({
            type: 'post',
            url: url, // we are calling json method
            //  data: $("#InvoicePrint").serialize(),

            success: function (data) {
                if (data.length != 0) {
                    $(".TRANCSNAME").val(data[0].IMPRTNAME);
                    $(".TRANIMPADDR1").val(data[0].IMPCATEADDR1);
                    $(".TRANIMPADDR2").val(data[0].IMPCATEADDR2);
                    $(".TRANIMPADDR3").val(data[0].IMPCATEADDR3);
                    $(".TRANIMPADDR4").val(data[0].IMPCATEADDR4);
                    $(".GSTNO").val(data[0].IMPCATEGSTNO);
                }
                else {
                    $("#TRANCSNAME").val("");
                    $("#TRANIMPADDR1").val("");
                    $("#TRANIMPADDR2").val("");
                    $("#TRANIMPADDR3").val("");
                    $("#TRANIMPADDR4").val("");
                    $(".GSTNO").val("");
                }
            }
        })


    }

    function IsAlphaNumeric(e) {
        var k;
        document.all ? k = e.keyCode : k = e.which;
        return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57) || k == 190 || k == 188);
    }


    function blockSpecialChar(e) {
        var k;
        document.all ? k = e.keyCode : k = e.which;
        return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57) || k == 190 || k == 188);
    }


    $("#Print").click(function () {

       // window.open("/NonPnrInvoice/PrintView/" + $(".FTRANMID").val() + ";" + $(".rpttype_f").val() + ";" + $(".FGSTAMT").val() + ";" + $(".brpttype_f").val() + ";" + $(".Tmp_handling").val());
        @*if ($(".TRANCSNAME").val() == "") { alert("Kindly Enter CHA Name...!"); $(".TRANCSNAME").focus(); return false; }

        if ($(".GSTNO").val() == "") { alert("Please update the GSTIN No...!"); $(".GSTNO").focus(); return false; }
            *@

        url = '@Url.Action("UpdateEMailMobile", "StuffingBill")/' + $(".TRANBILLREFID").val();

        $.ajax({
            type: 'post',
            url: url, // we are calling json method
            data: $("#InvoicePrint").serialize(),

            success: function (data) {
                //alert(data);
                if (data == "Saved") {
                    //console.log("/NonPnrInvoice/PrintView/" + $(".FTRANMID").val() + ";" + $(".rpttype_f").val() + ";" + $(".FGSTAMT").val() + ";" + $(".brpttype_f").val() + ";" + $(".Tmp_handling").val());
                    window.open("/StuffingBill/PrintView/" + $(".FTRANMID").val() + ";" + $(".rpttype_f").val() + ";" + $(".FGSTAMT").val() + ";" + $(".brpttype_f").val() + ";" + $(".Tmp_handling").val());
                    // window.open("/Invoice/PrintView/data?=" + $("#InvoicePrint").serialize());

                }
            }
        });


    });

    function closemodel() {
        var returnurl = '@Url.Action("Index", "StuffingBill")';
        window.location.href = returnurl;

    }

</script>

