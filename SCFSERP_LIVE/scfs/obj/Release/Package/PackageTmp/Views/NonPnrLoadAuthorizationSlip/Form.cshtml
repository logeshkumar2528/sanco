@using scfs_erp.Models;
@using scfs.Data;
@model scfs_erp.Models.AuthorizationSlipMD
@{
    ViewBag.Title = "Non Pnr Load Slip";
}
<style>
    .frm_hide {
        display: none;
    }
</style>
<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-search"></i>
                    <strong>Non Pnr Load Slip</strong>
                </div>
            </div>
            <div class="box-content" data-ng-app="myModule">
                <form action="@Url.Content("~/NonPnrLoadAuthorizationSlip/savedata")" method="post" accept-charset="utf-8" id="LoadAuthorizationSlipform" data-ng-controller="myController" name="LoadAuthorizationSlipform" onsubmit="return Form_validate()">
                    @Html.ValidationSummary(true)
                    <fieldset id="LoadAuthorizationSlipform_info">
                        <div class="row">
                            <div class="col-md-4 hidden">
                                <div class="form-group">
                                    <label>Primary  </label>
                                    @Html.TextBoxFor(model => model.masterdata[0].ASLMID, new { @class = "form-control  ASLMID", @id = "ASLMID" })
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Date<span class="required-field"></span> </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].ASLMDATE, "{0:dd/MM/yyyy}", new { @class = "form-control ASLMDATE", @id = "ASLMDATE", @data_val = false, @tabindex = "1", @placeholder = "Please Select Date" })
                                    @*@Html.TextBoxFor(model => Model.masterdata[0].ASLMDATE, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker ASLMDATE", @id = "ASLMDATE", @data_val = false, tabindex = "1" })*@

                                </div>
                            </div>
                            <div class="col-md-1">
                                <div class="form-group">
                                    <label>Time<span class="required-field"></span> </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].ASLMTIME, "{0:HH:mm:ss}", new { @class = "form-control timepicker ASLMTIME", @id = "ASLMTIME", @data_val = false, tabindex = "1" })

                                </div>
                            </div>
                            <div class="col-md-1">
                                <div class="form-group">
                                    <label>No  </label>
                                    @Html.TextBoxFor(model => model.masterdata[0].ASLMDNO, new { @class = "form-control  ASLMDNO", @id = "ASLMDNO", @readonly = true })
                                </div>
                            </div>

                            
                            @*<div class="col-md-2">
                                <div class="form-group">
                                    <label>Date/Time </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].ASLMTIME, new { @class = "form-control datetime ASLMTIME ", @id = "ASLMTIME", @data_Val = false, tabindex = "1" })
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>No  </label>
                                    @Html.TextBoxFor(model => model.masterdata[0].ASLMDNO, new { @class = "form-control  ASLMDNO", @id = "ASLMDNO", @readonly = true })
                                </div>
                            </div>*@


                            <div class="col-md-4">

                                <div class="form-group">
                                    <label>Driver Name </label>
                                    @Html.TextBoxFor(model => model.detaildata[0].DRVNAME, new { @class = "form-control  DRVNAME", @id = "DRVNAME", tabindex = "2" })

                                </div>
                            </div>

                            <div class="col-md-2">

                                <div class="form-group">
                                    <label>Trailor No </label>
                                    @Html.TextBoxFor(model => model.detaildata[0].VHLNO, new { @class = "form-control  VHLNO", @id = "VHLNO", tabindex = "3" })

                                </div>
                            </div>

                            <div class="col-md-2">

                                <div class="form-group">
                                    <label>Status </label>
                                    @Html.DropDownList("DISPSTATUS", null, new { @class = "form-control  DISPSTATUS", @id = "DISPSTATUS", tabindex = "5" })

                                </div>
                            </div>
                            @if (Model.masterdata != null)
                            {

                                <div class="col-md-2">

                                    <div class="form-group">
                                        <label>IGM No </label>@*@Html.ValidationMessageFor(model => model.masterdata[0].IGMNO)*@
                                        <input type="text" class="IGMNO form-control" name="IGMNO" id="IGMNO" value="@ViewBag.IGMNO" readonly />
                                        @*<input type="text" class="IGMNO form-control" name="IGMNO" id="IGMNO" value="" readonly />*@
                                    </div>
                                </div>
                                <div class="col-md-2">

                                    <div class="form-group">
                                        <label>Line No </label>@*@Html.ValidationMessageFor(model => model.masterdata[0].OSMLNO)*@
                                        <input type="text" class="GPLNO form-control" name="GPLNO" id="GPLNO" value="@ViewBag.GPLNO" readonly />
                                        @*<input type="text" class="GPLNO form-control" name="GPLNO" id="GPLNO" value="" readonly />*@

                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="col-md-3">

                                    <div class="form-group">
                                        <label>IGM No </label>@*@Html.ValidationMessageFor(model => model.masterdata[0].OSMIGMNO)*@
                                        <input type="text" class="IGMNO form-control" name="IGMNO" id="IGMNO" placeholder="---Please Type IGMNO----" tabindex="6" />
                                        @*@Html.TextBox("IGMNO", new { @class = "form-control  IGMNO", @id = "IGMNO", @placeholder = "---Please Type IGMNO----", tabindex = "48", @required = "required" })*@

                                    </div>
                                </div>
                                <div class="col-md-3">

                                    <div class="form-group">
                                        <label>Line No </label>@*@Html.ValidationMessageFor(model => model.masterdata[0].OSMLNO)*@
                                        <input type="text" class="GPLNO form-control" name="GPLNO" id="GPLNO" placeholder="---Please Type GPLNO----" tabindex="7" />
                                        @*@Html.TextBox("GPLNO", new { @class = "form-control  GPLNO", @id = "GPLNO", @required = "required", tabindex = "50", @placeholder = "---Please Type Line No----" })*@

                                    </div>
                                </div>
                                <div class="col-md-2">

                                    <div class="form-group">
                                        <br />
                                        <input type="button" name="search" value="search" class="btn btn-success btn-xs" id="search" onclick="GetDetail()" tabindex="8" />
                                    </div>
                                </div>
                            }
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Last Gate In</label>
                                    @Html.TextBox("GIMDATE", "{0:dd/MM/yyyy}", new { @class = "form-control GIMDATE", @readonly = "readonly", @id = "GIMDATE", @name = "GIMDATE" })
                                </div>
                            </div>
                        </div>
                        @if (Model.masterdata != null)
                        {<div class="Del_check hidden">@scfs_erp.Helper.Delete_fun.delete_check1("IMPORTAUTHSLIP", @Model.masterdata[0].ASLMID.ToString())</div>}
                        <div class="table_grid" id="table_grid">
                            @if (Model.detaildata != null)
                            {
                                <div class='panel-heading navbar-inverse' style='color:white'>Container Details</div>
                            <table id=mytabl class='table table-striped table-bordered bootstrap-datatable'>
                                    <thead><tr><th></th>
                                        <th>Container No</th><th> Size</th><th>InDate</th><th>GateIn No</th><th>BOE No</th><th>BOE Date</th><th>Liner Seal No</th><th>SANCO Seal No</th> </tr> </thead>
                                    <tbody>
                                        @foreach (PR_NONPNR_AUTHORIZATION_DETAIL_CTRL_ASSGN_Result det in Model.nonpnrdestuffdata)
                                        {
                                        <tr>
                                            <td>
                                                <input type='checkbox' name='CHKBX' class='CHKBX' id='CHKBX' onchange='SelectedCont(this)' />
                                                <input type=text name='booltype' class='booltype hidden' />                                            
                                            </td>
                                            <td class=hide>
                                                <input type=text id=GIDID class=GIDID name=GIDID value="@det.GIDID">
                                                <input type=text id=IGMNO class=IGMNO name=IGMNO value="@det.IGMNO">
                                                <input type=text id=GPLNO class=GPLNO name=GPLNO value="@det.GPLNO">
                                                <input type=text id=OSDID class=OSDID name=OSDID value="@det.OSDID">
                                                <input type=text id=OSMIGMNO class=OSMIGMNO name=OSMIGMNO value="@det.OSMIGMNO">
                                                <input type=text id=OSMLNO class=OSMLNO name=OSMLNO value="@det.OSMLNO">
                                            </td>
                                            <td class=hide><input type=text id=ASLDID value="@det.ASLDID" class=ASLDID name=ASLDID hidden></td>
                                            <td class=hide><input type=text id=STMRNAME value="@det.STMRNAME" class=STMRNAME name=STMRNAME></td>
                                            <td class=hide><input type=text id=IMPRTNAME value="@det.IMPRTNAME" class=IMPRTNAME name=IMPRTNAME hidden></td>
                                            <td class=hide><input type=text id=VOYNO value="@det.VOYNO" class=VOYNO name=VOYNO hidden></td>
                                            <td class=hide><input type=text id=VSLNAME value="@det.VSLNAME" class=VSLNAME name=VSLNAME hidden></td>
                                            <td class='col-lg-3'><input type=text id=CONTNRNO value="@det.CONTNRNO" class='form-control CONTNRNO' name=CONTNRNO readonly></td>
                                            <td class='col-lg-1'><input type=text value="@det.CONTNRSDESC" id=CONTNRSDESC class='CONTNRSDESC form-control' name=CONTNRSDESC readonly></td>
                                            <td class='col-lg-2'><input type=text id=GIDATE value='@det.GIDATE.ToString("dd/MM/yyyy")' class='GIDATE form-control' name=GIDATE readonly></td>
                                            <td class='col-lg-2'><input type=text id=GIDNO class='form-control GIDNO' name=GIDNO value='@det.GIDNO' readonly></td>
                                            <td class='col-lg-2'><input type=text id=BOENO class='form-control BOENO' name=BOENO value='@det.BOENO' readonly></td>
                                            <td class='col-lg-2'><input type=text id=BOEDATE class='form-control BOEDATE' name=BOEDATE value='@det.BOEDATE.ToString("dd/MM/yyyy")' readonly></td>
                                            @*<td class='col-lg-2'><input type=text id=DODATE class='form-control DODATE' name=DODATE readonly style=width:89px value='@det.DODATE.ToString("dd/MM/yyyy")'></td>*@
                                            <td class='col-lg-2'><input type=text value='@det.LSEALNO' id=LSEALNO class='form-control LSEALNO' name=LSEALNO readonly style=width:65px></td>
                                            <td class='col-lg-2'><input type=text value='@det.SSEALNO' id=SSEALNO class='form-control SSEALNO' name=SSEALNO readonly style=width:65px></td>
                                        </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                        </div>
                        <div class="col-md-12 box-footer">


                            <input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs pull-left" onclick="JavaScript:history.back()" />

                            <input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs" id="save" tabindex="5000" />


                        </div>

                    </fieldset>

                </form>


            </div>
        </div>
    </div>

</div>
@section Scripts{
    <script type="text/javascript" src="~/Scripts/CommonValidation.js"></script>
    <script>

        var base = window.location.origin;

        function GetOperation() {
            ASLDTYPE = $("#ASLDTYPE option:selected").val();
            if (ASLDTYPE == 1) {
                $("#LBR_LBL").html("Operation");
                $("#LBR_DIV").html("<select class='form-control ASLOTYPE' id='ASLOTYPE' name='detaildata[0].ASLOTYPE'></select>");
                base = window.location.origin;
                url = base + "/NonPnrLoadAuthorizationSlip/GetOperation/";
                $.ajax({
                    type: 'get', url: url,
                    success: function (data, status) {
                        // alert(data);
                        $.each(data, function (key, value) {
                            //s alert(value.OPRTYPE);
                            $("#ASLOTYPE").append("<option value=" + value.OPRTYPE + ">" + value.OPRTYPEDESC + "</option>");
                        })
                    }
                });
            }
            else {
                $("#LBR_LBL").html("Labour Type");
                $("#LBR_DIV").html("<select class='form-control ASLLTYPE' id='ASLLTYPE' name='detaildata[0].ASLLTYPE'><option value=0>SANCO</option><option value=1>CHA</option></select>");
            }
        }

        function GetDetail() {
            $("#table_grid").html("");
            var IGM_No = $("#IGMNO").val();
            var Line_No = $("#GPLNO").val();
            
            url = base + "/NonPnrLoadAuthorizationSlip/Detail/" + IGM_No + ";" + Line_No;

            $.ajax({
                type: 'get',
                url: url,
                data: { id: IGM_No + ";" + Line_No },
                success: function (data, status) {
                    $("#table_grid").html(data);
                    if ($("#mytabl tbody tr").length == 0) { $("#table_grid").html("<p style='color:red'>There is no Gate In / Already Existed Record for Given IGMNO & LineNo</p>"); }
                    else {

                        $("#table_grid").html(data);
                    }
                }
            });//-----End of post
            var murl = base + "/NonPnrLoadAuthorizationSlip/GateinMaxDate/" + IGM_No + ";" + Line_No;
            $.ajax({
                type: 'get',
                url: murl,
                //url: 'Url.Action("GateinMaxDate", "NonPnrLoadAuthorizationSlip")/',
                //data: { igmno: IGM_No, gplno: Line_No },
                success: function (result) {
                    //alert(data);
                    var inDate = result[0].GIDATE; //Wed Feb 09 2011 15:41:41 GMT+0530 (India Standard Time)
                    var JavaScriptDate = new Date(parseInt(inDate.substr(6))); //to js format
                    var dt = new Date(JavaScriptDate); //Date object

                    var year = dt.getFullYear();
                    var month = dt.getMonth() + 1;
                    var day = dt.getDate();

                    if (month < 10) month = "0" + month;
                    if (day < 10) day = "0" + day;

                    $(".GIMDATE").val(day + "/" + month + "/" + year);
                    //$(".GIMDATE").val(GetFormattedDate(result[0].GIDATE));
                }
            });
            //return false;
        }

        $(document).ready(function () {
            window.onbeforeunload = function () {
                $("input[type=submit]").attr("disabled", "disabled");
            };
            //------Autocomplete Function-----------------
            //add_autocomplete($("#IGMNO"), "IGMNO");

            //---End

            $('input[id$=ASLMDATE]').datepicker({
                dateFormat: 'dd/mm/yy',
                autoclose: true,
                endDate: "today",
                maxDate: new Date(),
                onClose: function (dateText, inst) {
                    $("#ASLMDATE").focus();
                }
            });
            $('.ASLMDATE').removeClass('hasDatepicker');

            //-----------DATE CONTROLS----------------//
            $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', maxDate: new Date() });
            $('.timepicker').datetimepicker({
                datepicker: false,
                format: 'H:i'
            });

         
            //$('.datetime').datetimepicker({
            //    dateFormat: 'dd/mm/yy',
            //    maxDate: new Date(),
            //    timeFormat: 'hh:mm'
            //});
            //$('.time').timepicker();
            //  GetDetail();

            if ($(".ASLMID").val() == "") {
                $(".ASLMID").val("0");
            }

            if ($(".ASLMID").val() == "0") {
                var dt = new Date();

                var year = dt.getFullYear();
                var month = dt.getMonth() + 1;
                var day = dt.getDate();

                if (month < 10) month = "0" + month;
                if (day < 10) day = "0" + day;

                //var month = dt.getMonth() + 1;
                //var date = dt.getDate() + "/" + month + "/" + dt.getFullYear();
                //console.log(year + '/' + month + '/' + day);

                var date = day + '/' + month + '/' + year;

                var hours = dt.getHours();
                var minutes = dt.getMinutes();
                var seconds = dt.getSeconds();

                if (hours < 10) hours = "0" + hours;
                if (minutes < 10) minutes = "0" + minutes;
                if (seconds < 10) seconds = "0" + seconds;

                var time = hours + ':' + minutes + ':' + seconds;

                $(".ASLMDATE").val(date);
                $(".ASLMTIME").val(time);

                //$(".ASLMTIME").val(date + " " + datetme);


                //$('#DODATE').on("change", function () {
                //    var odt = $(".OSMDATE").val();
                //    var ss = $(".DODATE").val();
                //    var start = new Date(odt);

                //    var end = new Date(ss);
                //    alert(start.getDate());
                //    var days = (end.getDate() - start.getDate()) / 1000 / 60 / 60 / 24;
                //    alert(days);
                //});

            }
            else {
                if ($(".Del_check").html() != "PROCEED") {
                    alert($(".Del_check").html()); $("#add_detail,#del_detail").addClass("hide");
                    $("#LoadAuthorizationSlipform input:submit").attr("disabled", "disabled");
                } else { $("#add_detail,#del_detail").removeClass("hide"); $("#LoadAuthorizationSlipform input:submit").removeAttr("disabled", "disabled"); }

                $("#OSMIGMNO").val($("#IGMNO").val());
                $("#OSMLNO").val($("#GPLNO").val());

                var IGM_No = $("#OSMIGMNO").val();
                var Line_No = $("#OSMLNO").val();

                var murl = base + "/NonPnrLoadAuthorizationSlip/GateinMaxDate/" + IGM_No + ";" + Line_No;
                $.ajax({
                    type: 'get',
                    url: murl,
                    //url: 'Url.Action("GateinMaxDate", "NonPnrLoadAuthorizationSlip")/',
                    //data: { igmno: IGM_No, gplno: Line_No },
                    success: function (result) {
                        //alert(data);
                        var inDate = result[0].GIDATE; //Wed Feb 09 2011 15:41:41 GMT+0530 (India Standard Time)
                        var JavaScriptDate = new Date(parseInt(inDate.substr(6))); //to js format
                        var dt = new Date(JavaScriptDate); //Date object

                        var year = dt.getFullYear();
                        var month = dt.getMonth() + 1;
                        var day = dt.getDate();

                        if (month < 10) month = "0" + month;
                        if (day < 10) day = "0" + day;

                        $(".GIMDATE").val(day + "/" + month + "/" + year);
                        //$(".GIMDATE").val(GetFormattedDate(result[0].GIDATE));
                    }
                });                

                ASLDTYPE = $("#ASLDTYPE option:selected").val();
                if (ASLDTYPE == 1) {
                    var selval = "";
                    $("#LBR_LBL").html("Operation");
                    $("#LBR_DIV").html("<select class='form-control ASLOTYPE' id='ASLOTYPE' name='detaildata[0].ASLOTYPE'></select>");
                    base = window.location.origin;
                    url = base + "/NonPnrLoadAuthorizationSlip/GetOperation/";
                    $.ajax({
                        type: 'get', url: url,
                        success: function (data, status) {
                            // alert(data);
                            $.each(data, function (key, value) {
                                // alert($("#F_OTYPE").val() + ";;;;" + value.OPRTYPE);
                                if ($("#F_OTYPE").val() == value.OPRTYPE) selval = "selected";
                                else selval = "";
                                $("#ASLOTYPE").append("<option value=" + value.OPRTYPE + " " + selval + ">" + value.OPRTYPEDESC + "</option>");
                            })
                        }
                    });
                }
                //else {
                //    var selval = ""; if ($("#F_LTYPE").val() == "1") selval = "selected"; else selval = "";
                //    $("#LBR_LBL").html("Labour Type");
                //    $("#LBR_DIV").html("<select class='form-control' id='ASLLTYPE'><option value=0>SANCO</option><option value=1 "+selval+">CHA</option></select>");
                //}
            }
            //--------------END OF DATE CONTROLS----------//

            //-------------------Duplicate check ---------------------------------
            $("#BOENO").blur(function () {
                var boe = $("#BOENO").val();

                base = window.location.origin;

                $.post(base + "/NonPnrLoadAuthorizationSlip/BOEDetail",
                    {
                        BoeNo: boe
                    },
                    function (data, status) {
                        if (data == "") { return false; }
                        else {
                            //alert(data);

                            $('<div></div>').dialog({
                                modal: true,
                                title: "Information",
                                open: function () {
                                    var markup = '<b>' + data + '<b>';
                                    $(this).html(markup);
                                },
                                buttons: {
                                    Ok: function () {
                                        $(this).dialog("close");
                                    }
                                }
                            }); //end confirm dialog
                            $("#BOENO").val(""); $("#BOENO").focus();
                        }
                    })
            });//------End of Duplicate Check


            //-------------Labour Name----------------------------
            $("#LCATEID").change(function () {
                var osmcatelId = $('#LCATEID option:selected').text();
                //$("#OSMLCATENAME").val(osmcatelId);
            })//---End of Labour Name



            //-------------CHA Licence Name-------------------
            //$('#OSMNAME').blur(function () {

            //    var selectedvalue = $('#OSMNAME').val();

            //    $('#OSMLNAME').val(selectedvalue);
            //});//-----End of CHA

        });//---End of Document Ready Event------------------

        $(window).bind("load", function () {
            if ($(".ASLMID").val() == "") {
                $(".ASLMID").val("0");
            }
        });

        function SelectedCont(obj) {
            var i = 0;
            $(".CHKBX").each(function () {
                if ($(this).is(':Checked') == true) {
                    $(".booltype")[i].value = "true";

                }
                else {
                    $(".booltype")[i].value = "false";
                }
                i++;
            })
        }

        function Form_validate() {

             if ($('.ASLMID').val() == "0" && $('#ASLMDATE').val() == "") {
                alert('Please Select Slip Date !!');
                $('#ASLMDATE').focus();
                return false;
            }

            if ($('.ASLMID').val() == "0" && $('#ASLMTIME').val() == "") {
                alert('Please Select Time !!');
                $('#ASLMTIME').focus();
                return false;
            }

            if ($('.ASLMID').val() == "0" && $('#IGMNO').val() == "") {
                alert('Please Enter IGM No !!');
                $('#IGMNO').focus();
                return false;
            }
            if ($('.ASLMID').val() == "0" && $("#GPLNO").val() == "") {
                alert('Please Enter Line No !!');
                $('#GPLNO').focus();
                return false;
            }

            if ($('.ASLMDATE').val() != "" && $('.GIMDATE').val() != "") {
                var slipdate = Splitthedate($('.ASLMDATE').val());              
                var Gidate = Splitthedate($('.GIMDATE').val());

                if (slipdate < Gidate) {
                    alert('Slip date Grater Than Gate In Date !!');
                    $('.ASLMDATE').focus();
                    return false;
                }
            }
                        
            var badi = 0;
            $(".CHKBX").each(function () {
                if ($(this).is(':Checked') == true) {
                    flag = true;
                    badi++;
                }
                else {
                    flag = false;
                }
            })
            flag = true;
            if (badi == 0) {
                alert("Please check the Container Details !!");
                $(".CHKBX").focus();
                flag = false;
                return false;
            }

            //temp2 = $("#IGMNO").val();
            //if (temp2 == "") {
            //    alert("Please Select IGM No....!");
            //    $(".IGMNO").focus();
            //    return false;
            //}
        }

    </script>
    @*@Scripts.Render("~/bundles/jqueryval")*@
}

