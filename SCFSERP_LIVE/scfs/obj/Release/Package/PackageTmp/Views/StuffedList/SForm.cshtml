@using scfs_erp.Models;
@using scfs.Data;
@model scfs_erp.Models.StuffingList

@{
    Layout = "~/Views/Shared/_PopupLayout.cshtml";
    ViewBag.Title = "Form";
}

<style>
    .frm_hide {
        display: none;
    }

    .modal-header {
        background: #0480be;
    }

    h5 {
        color: white;
    }

    legend {
        background-color: dimgrey;
        color: white;
        padding: 5px 10px;
        font-size: 15px;
    }

    #tblsbill {
        background-color: Highlight;
        color: white;
    }

    .modal-header {
        padding: 0.5rem;
    }
</style>

<div class="modal-body">
    <div class="modal-content">
        <form id="StuffingJson" method="post" action="@Url.Action("PrintView","StuffingBill")">
            <div class="modal-header">
                <button type="button" class="close hide" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h5 class="modal-title">Stuffed JSON Details</h5>
            </div>
            <div class="modal-body">

                <div class="col-lg-12">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Stuffing No.</label>
                                    <input class="form-control STFMDNO" id="STFMDNO" name="STFMDNO" value="@Model.stuffeddetails[0].STFMDNO" readonly="readonly" tabindex="-1">
                                    <input class="form-control STFXID hide" id="STFXID" name="STFXID" value="@ViewBag.id" tabindex="-1">
                                    <input class="form-control STFDID hide" id="STFDID" name="STFDID" value="@ViewBag.STFDID" tabindex="-1">
                                    <input class="form-control STFXNO hide" id="STFXNO" name="STFXNO" value="@ViewBag.STFXNO" tabindex="-1">
                                    <input class="form-control STFXDNO hide" id="STFXDNO" name="STFXDNO" value="@ViewBag.STFXDNO" tabindex="-1">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Stuffing Date</label>
                                    <input class="form-control STFMDATE" id="STFMDATE" name="STFMDATE" value="@Model.stuffeddetails[0].STFMDATE.ToString("dd/MM/yyyy")" readonly="readonly" tabindex="-1">
                                </div>
                            </div>
                            <div class="col-md-5">
                                <div class="form-group">
                                    <label>CHA Name</label>
                                    <input class="form-control STFBILLREFNAME" id="STFBILLREFNAME" name="STFBILLREFNAME" value="@Model.stuffeddetails[0].STFBILLREFNAME" readonly="readonly" tabindex="-1">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Operation Type</label>
                                    <input class="form-control EOPTDESC" id="EOPTDESC" name="EOPTDESC" value="@Model.stuffeddetails[0].EOPTDESC" readonly="readonly" tabindex="-1">
                                </div>
                            </div>

                        </div>
                    </div>
                    <fieldset>
                        <legend>Manifest_Master/Message Head</legend>
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Message Type</label>
                                            @Html.DropDownList("STF_MSG_TID", null, "Select Message Type", new { @class = "form-control STF_MSG_TID", @id = "STF_MSG_TID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Port of Reporting</label>
                                            @Html.DropDownList("PRID", null, "Select Port of Reporting", new { @class = "form-control PRID", @id = "PRID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Reporting Event</label>
                                            @Html.DropDownList("REID", null, "Select Reporting Event", new { @class = "form-control REID", @id = "REID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Reporting party Type</label>
                                            @Html.DropDownList("RPTYPEID", null, "Select Reporting party Type", new { @class = "form-control RPTYPEID", @id = "RPTYPEID" })
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Reporting Party Code or Custodian Code</label>
                                            <input class="form-control STF_RPTYPE_CODE" id="STF_RPTYPE_CODE" name="STF_RPTYPE_CODE" value="@ViewBag.STF_RPTYPE_CODE">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Reporting Location Name</label>
                                            <input class="form-control STF_RLOCT_NAME" id="STF_RLOCT_NAME" name="STF_RLOCT_NAME" value="@ViewBag.STF_RLOCT_NAME">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Reporting Location Code</label>
                                            <input class="form-control STF_RLOCT_CODE" id="STF_RLOCT_CODE" name="STF_RLOCT_CODE" value="@ViewBag.STF_RLOCT_CODE">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Authorised Person PAN</label>
                                            <input class="form-control STF_AP_PANNO" id="STF_AP_PANNO" name="STF_AP_PANNO" value="@ViewBag.STF_AP_PANNO">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Cargo Contianer</legend>
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Container No.</label>
                                            <input class="form-control STF_CONTNRNO" id="STF_CONTNRNO" name="STF_CONTNRNO" value="@Model.stuffeddetails[0].CONTNRNO" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment Type</label>
                                            @Html.DropDownList("EQTID", null, "Select Equipment Type", new { @class = "form-control EQTID", @id = "EQTID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Container Size</label>
                                            <input class="form-control STF_CONTNRSDESC" id="STF_CONTNRSDESC" name="STF_CONTNRSDESC" value="@Model.stuffeddetails[0].CONTNRSDESC" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment Load Status</label>
                                            @Html.DropDownList("ELSID", null, "Select Equipment Load Status", new { @class = "form-control ELSID", @id = "ELSID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Additional Equipment Hold</label>
                                            <input class="form-control STF_AEQUIPDESC" id="STF_AEQUIPDESC" name="STF_AEQUIPDESC" value="@ViewBag.STF_AEQUIPDESC">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Final Destination Location</label>
                                            @*<input class="form-control STF_FDSTNCODE" id="STF_FDSTNCODE" name="STF_FDSTNCODE" value="@ViewBag.STF_FDSTNCODE">*@
                                            @Html.DropDownList("FDID", null, "Select Final Destination", new { @class = "form-control FDID", @id = "FDID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Event Date</label>
                                            <input class="form-control EVENTDATE" id="EVENTDATE" name="EVENTDATE" value="@Model.stuffeddetails[0].STFMDATE.ToString("dd/MM/yyyy")" readonly="readonly" tabindex="-1">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment Seal Type</label>
                                            @Html.DropDownList("ESTYPEID", null, "Select Equipment Seal Type", new { @class = "form-control ESTYPEID", @id = "ESTYPEID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment Seal Number</label>
                                            <input class="form-control STF_EQSEALNO" id="STF_EQSEALNO" name="STF_EQSEALNO" value="@Model.stuffeddetails[0].CSEALNO.ToString()" readonly="readonly">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Other Equipment ID</label>
                                            <input class="form-control STF_OTHR_EQID" id="STF_OTHR_EQID" name="STF_OTHR_EQID" value="@ViewBag.STF_OTHR_EQID">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Equipment Status</label>
                                            @Html.DropDownList("ESID", null, "Select Equipment Status", new { @class = "form-control ESID", @id = "ESID" })
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment package</label>
                                            <input class="form-control STF_EQPKG_DESC" id="STF_EQPKG_DESC" name="STF_EQPKG_DESC" value="@ViewBag.STF_EQPKG_DESC" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment Quantity</label>
                                            <input class="form-control STF_EQPKG_QTY" id="STF_EQPKG_QTY" name="STF_EQPKG_QTY" value="@ViewBag.STF_EQPKG_QTY">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>Equipment UQC</label>
                                            @Html.DropDownList("EUQCID", null, "Select Equipment UQC", new { @class = "form-control EUQCID", @id = "EUQCID" })
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </fieldset>
                </div>


                <!---->
                <div class="clearfix">

                    <div class="col-lg-12 ">
                        <div class="panel-body">
                            <div class="table-responsive" id="job_list_inner">

                                <input type="text" id="TDETAIL_IDX" value="0" name="TDETAIL_IDX[]" class="TDETAIL_IDX" style="display:none" />
                                <table class='table table-striped table-bordered bootstrap-datatable' id="TDETAIL">
                                    <thead id="tblsbill"><tr><th>SBill No.</th><th>SBill Date</th><th>Product Description</th><th>NOP</th><th>PACKETS FROM</th><th>PACKETS TO</th><th class="hide"> <a class="btn btn-success btn-xs" href="#" id="add_detail"><i class="fa fa-plus-square "></i>  </a></th></tr> </thead>
                                    <tbody class="TDETAIL_BODY" id="TDETAIL_BODY">
                                        @if (Model.sbilldetails != null)
                                        {
                                            foreach (z_pr_XML_Stuffed_SBill_No_Detail_Assgn_Result details in Model.sbilldetails)
                                            {
                                                <tr class="item-row">
                                                    <td class="hidden">
                                                        <input class="form-control hide STFPID" id="STFPID" name="STFPID" value="@details.STFPID">
                                                    </td>
                                                    <td class="col-lg-2">
                                                        <input class="form-control SBILLNO" id="SBILLNO" name="SBILLNO" value="@details.STFDSBNO" readonly>
                                                    </td>
                                                    <td class="col-lg-2">
                                                        <input class="form-control SBILLDATE" id="SBILLDATE" name="SBILLDATE" value="@details.STFDSBDATE.ToString("dd/MM/yyyy")" readonly>
                                                    </td>
                                                    <td class="col-lg-3">
                                                        <input class="form-control SBPRDTDESC" id="SBPRDTDESC" name="SBPRDTDESC" value="@details.PRDTDESC" readonly>
                                                    </td>
                                                    <td class="col-lg-1">
                                                        <input class="form-control SBNOP" id="SBNOP" name="SBNOP" value="@details.STFDNOP" readonly>
                                                    </td>
                                                    <td class="col-lg-2">
                                                        <input class="form-control STF_PACKETS_FROM" id="STF_PACKETS_FROM" name="STF_PACKETS_FROM" value="@details.STF_PACKETS_FROM">
                                                    </td>
                                                    <td class="col-lg-2">
                                                        <input class="form-control STF_PACKETS_TO" id="STF_PACKETS_TO" name="STF_PACKETS_TO" value="@details.STF_PACKETS_TO">
                                                    </td>
                                                    <td class="col-lg-1 hide"><a class="btn btn-danger btn-xs hide" id="sub_del_detail" onclick="del()"> <i class="fa fa-trash-o"></i></a></td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {

                                            <tr class="item-row">
                                                <td class="hidden">
                                                    <input class="form-control hide STFPID" id="STFPID" name="STFPID" value="0">
                                                </td>
                                                <td class="col-lg-2">
                                                    <input class="form-control SBILLNO" id="SBILLNO" name="SBILLNO" value="">
                                                </td>
                                                <td class="col-lg-2">
                                                    <input class="form-control SBILLDATE" id="SBILLDATE" name="SBILLDATE" value="">
                                                </td>
                                                <td class="col-lg-3">
                                                    <input class="form-control SBPRDTDESC" id="SBPRDTDESC" name="SBPRDTDESC" value="">
                                                </td>
                                                <td class="col-lg-1">
                                                    <input class="form-control SBNOP" id="SBNOP" name="SBNOP" value="">
                                                </td>
                                                <td class="col-lg-2">
                                                    <input class="form-control STF_PACKETS_FROM" id="STF_PACKETS_FROM" name="STF_PACKETS_FROM" value="">
                                                </td>
                                                <td class="col-lg-2">
                                                    <input class="form-control STF_PACKETS_TO" id="STF_PACKETS_TO" name="STF_PACKETS_TO" value="">
                                                </td>
                                                <td class="hide555"><a class="btn btn-danger btn-sm" id="sub_del_detail" onclick="del()"> <i class="fa fa-trash-o"></i></a></td>
                                            </tr>

                                        }
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
                <!---->

                <div class="clearfix"> </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="btm_btnClosePopup" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="SaveClick">Create Json</button>
                </div>
            </div>

        </form>
    </div>
</div>

<script>

    function IsAlphaNumeric(e) {
        var k;
        document.all ? k = e.keyCode : k = e.which;
        return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57) || k == 190 || k == 188);
    }


    function blockSpecialChar(e) {
        var k;
        document.all ? k = e.keyCode : k = e.which;
        return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57) || k == 190 || k == 188);
    }


    $("#btm_btnClosePopup").click(function () {
        $("#batchfrm").modal("hide");
        location.reload();
        //alert("a");
    });

    //ADD DETAIL
    $(function () {
        var rowcount = $('#TDETAIL tbody tr').length;//....Cloning
        $("#TDETAIL_IDX").val(rowcount);
        $("#add_detail").click(function () {
            if ($("#TDETAIL_IDX").val() != 0) {
                var $tableBody = $('#TDETAIL').find("tbody"),
                    $trLast = $tableBody.find("tr:last");
                $trNew = $trLast.clone();
                $trLast.after($trNew);
                $trNew.find("input:text,select").val("");

                var row_idx = parseInt($("#TDETAIL_IDX").val());
                $trNew.find(".TCOUNT").val(row_idx + 1);

                $trNew.find("#STFDPID").val("0");
                //$trNew.find("#CORDDREFID").val("0");

                var row_idx = parseInt($("#TDETAIL_IDX").val());
                $("#TDETAIL_IDX").val(row_idx + 1);
                $("#TDETAIL_BODY").show();
                //regroup("TDETAIL");
                //test001();
            }
            else {
                $('#TDETAIL_IDX').val("1");
                $("#TDETAIL_BODY").show();
            }
            return false;
        });
    });
    //ADD DETAIL

    //save click start
    $("#SaveClick").click(function () {

        base = window.location.origin;
        var formdata = ($("#StuffingJson").serialize());

        flag = true;

        // alert(formdata);
        if ($('#SRF_RPT_DATE').val() == "" || $('#SRF_RPT_DATE').val() == ".") {
            $(".msg_error").html("Please Select Date..!");
            $('.msg_error').show();
            $('.msg_error').delay(1200).fadeOut(1000);
            $('#SRF_RPT_DATE').focus(); $("#SRF_RPT_DATE").val("");
            flag = false;
            return false;
        }

        var msgtype = $(".STF_MSG_TID option:selected").val();
        if (msgtype == "") {
            alert("Please Select the Message Type !!");
            $('#STF_MSG_TID').focus();
            flag = false;
            return false;
        }

        var prid = $(".PRID option:selected").val();
        if (prid == "") {
            alert("Please Select the Port of Reporting !!");
            $('#PRID').focus();
            flag = false;
            return false;
        }

        var peid = $(".REID option:selected").val();
        if (peid == "") {
            alert("Please Select the Reporting Event !!");
            $('#REID').focus();
            flag = false;
            return false;
        }

        var rptypeid = $(".RPTYPEID option:selected").val();
        if (rptypeid == "") {
            alert("Please Select the Reporting party Type !!");
            $('#RPTYPEID').focus();
            flag = false;
            return false;
        }

        if ($('#STF_RPTYPE_CODE').val() == "") {
            alert("Please Enter the Reporting Party Code or Custodian Code !!")
            $('#STF_RPTYPE_CODE').focus(); $("#STF_RPTYPE_CODE").val("");
            flag = false;
            return false;
        }

        if ($('#STF_RLOCT_NAME').val() == "") {
            alert("Please Enter the Reporting Location Name !!")
            $('#STF_RLOCT_NAME').focus(); $("#STF_RLOCT_NAME").val("");
            flag = false;
            return false;
        }

        if ($('#STF_RLOCT_CODE').val() == "") {
            alert("Please Enter the Reporting Location Code !!")
            $('#STF_RLOCT_CODE').focus(); $("#STF_RLOCT_CODE").val("");
            flag = false;
            return false;
        }

        if ($('#STF_AP_PANNO').val() == "") {
            alert("Please Enter the Authorised Person PAN !!")
            $('#STF_AP_PANNO').focus(); $("#STF_AP_PANNO").val("");
            flag = false;
            return false;
        }

        var eqtid = $(".EQTID option:selected").val();
        if (eqtid == "") {
            alert("Please Select the Equipment Type !!");
            $('#EQTID').focus();
            flag = false;
            return false;
        }

        var elsid = $(".ELSID option:selected").val();
        if (elsid == "") {
            alert("Please Select the Equipment Load Status !!");
            $('#ELSID').focus();
            flag = false;
            return false;
        }

        var fdid = $(".FDID option:selected").val();
        if (fdid == "") {
            alert("Please Select the Final Destination !!");
            $('#FDID').focus();
            flag = false;
            return false;
        }

        //if ($('#STF_FDSTNCODE').val() == "") {
        //    alert("Please Enter the Final Destination Location !!")
        //    $('#STF_FDSTNCODE').focus(); $("#STF_FDSTNCODE").val("");
        //    flag = false;
        //    return false;
        //}

        var esealtid = $(".ESTYPEID option:selected").val();
        if (esealtid == "") {
            alert("Please Select the Equipment Seal Type !!");
            $('#ESTYPEID').focus();
            flag = false;
            return false;
        }

        if ($('#STF_EQSEALNO').val() == "") {
            alert("Please Enter the Equipment Seal Number !!")
            $('#STF_EQSEALNO').focus(); $("#STF_EQSEALNO").val("");
            flag = false;
            return false;
        }

        var esid = $(".ESID option:selected").val();
        if (esid == "") {
            alert("Please Select the Equipment Status !!");
            $('#ESID').focus();
            flag = false;
            return false;
        }

        if ($('#STF_EQPKG_QTY').val() == "") {
            alert("Please Enter the Equipment Quantity !!")
            $('#STF_EQPKG_QTY').focus(); $("#STF_EQPKG_QTY").val("");
            flag = false;
            return false;
        }

        var euqcid = $(".EUQCID option:selected").val();
        if (euqcid == "") {
            alert("Please Select the Equipment UQC !!");
            $('#EUQCID').focus();
            flag = false;
            return false;
        }

        var chkinkbad = 1;
        var inkbad = 0;
        var pstatus = 1;

        //Ink Grid Validation
        if (chkinkbad > 0) {
            //alert("ink");

            $('#TDETAIL :text,#TDETAIL checkbox').each(function () {
                //pstatus = 0;
                //alert(this.id + " : " + this.value);
                switch (this.id) {
                    case "STF_PACKETS_FROM":
                        if (pstatus == 1) {
                            if ($.trim(this.value) == "" || $.trim(this.value) == "0") {
                                alert("Please Enter the Packets From Details Properly !!");
                                inkbad++;
                                this.focus();
                            }
                            if (inkbad >= 1) { return false; }
                            break;
                        }
                    case "STF_PACKETS_TO":
                        if (pstatus == 1) {
                            if ($.trim(this.value) == "" || $.trim(this.value) == "0") {
                                alert("Please Enter the Packets To Details Properly !!");
                                inkbad++;
                                this.focus();
                            }
                            if (inkbad >= 1) { return false; }
                            break;
                        }
                    default:
                        if (pstatus == 1) {
                            if ($.trim(this.value) == "") inkbad++;
                        }

                }
            });

            //alert(inkbad);
            if (inkbad < 1) {

                //return true;

            }
            else {
                //alert("Please Check the Ink Detail before save");
                //$(".M_ITEMID").focus();
                return false;
            }
        }

        $.ajax({
            type: 'post',
            url: '@Url.Action("S_Savedata","StuffedList")', // we are calling json method
            data: formdata,
            success: function (data) {
                if (data == "saved") {

                    swal({
                        title: "Saved",
                        text: "Json File Created Successfully !!",
                        type: "success",
                        timer: 10000
                    }).then(function () {
                        location.replace(base + "/StuffedList");
                    }
                    );
                    //$('.msg').html("Saved Successfully");
                    //$('.msg').show();
                    //$('.msg').delay(1200).fadeOut(1000);
                    //$('#myModal').modal('hide');
                    //location.reload();


                }

            },
            error: function (ex) {
                alert('Failed to save data ' + ex);
            }
        });


    });
    //save click end


</script>