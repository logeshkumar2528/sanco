@using scfs.Data
@using scfs_erp.Models;

@model scfs_erp.Models.ExportShippingAdmission

@{
    ViewBag.Title = "Shipping Admission - Multiple";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/Site.css" type="text/css" rel="stylesheet" />


<section id="main-content">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-12">
                <div class="box">
                    <div class="panel panel-primary" style="background: #323C55;">
                        <div class="panel-heading">
                            <div class="panel-title">
                                <i class="glyphicon glyphicon-export"></i>Shipping Admission - Multiple
                            </div>
                        </div>
                    </div>

                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>From Date <span class="required-field"></span> </label>
                                        <input type="text" id="fromDt" name="fromDt" class="form-control datepicker fromDt" value="@System.Web.HttpContext.Current.Session["SDATE"]" tabindex="1">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>To Date <span class="required-field"></span> </label>
                                        <input type="text" id="toDt" name="toDt" class="form-control datepicker toDt" value="@System.Web.HttpContext.Current.Session["EDATE"]" tabindex="2">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Exporter <span class="required-field"></span> </label>
                                        @*<input type="text" id="EXPRTNAME" name="EXPRTNAME" class="form-control EXPRTNAME" data_autocomplete_url=Url.Action('AutoExpoter','ExportCartingOrder') placeholder="----Please Select----" tabindex="3">
                                            <input type="text" id="EXPRTID" name="EXPRTID" class="form-control EXPRTID hide" tabindex="-1">*@
                                        @Html.TextBoxFor(model => Model.EXPRTNAME, new { @class = "form-control EXPRTNAME", @id = "EXPRTNAME", data_autocomplete_url = Url.Action("AutoExpoter", "ExportCartingOrder"), @placeholder = "----Please Select----", tabindex = "3" })
                                        @Html.HiddenFor(model => Model.EXPRTID, new { @class = "form-control  EXPRTID", @id = "EXPRTID" })
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>CHA <span class="required-field"></span>  </label>
                                        @*<input type="text" id="CHANAME" name="CHANAME" class="form-control CHANAME" data_autocomplete_url=Url.Action('AutoCha','ExportCartingOrder') placeholder="----Please Select----" tabindex="4">
                                            <input type="text" id="CHAID" name="CHAID" class="form-control CHAID hide" tabindex="-1">*@
                                        @Html.TextBoxFor(model => Model.CHANAME, new { @class = "form-control  CHANAME", @id = "CHANAME", data_autocomplete_url = Url.Action("AutoCha", "ExportCartingOrder"), @placeholder = "----Please Select----", tabindex = "5" })
                                        @Html.HiddenFor(model => Model.CHAID, new { @class = "form-control  CHAID", @id = "CHAID" })
                                    </div>
                                </div>
                                <div class="col-md-2">

                                    <div class="form-group">
                                        <br />
                                        <input type="button" name="search" value="Search" class="btn btn-success btn-xs" id="search" onclick="GetMSBDetail()" tabindex="8" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <form action="@Url.Content("~/ExportCartingOrder/SaveESBMultipleData")" method="post" accept-charset="utf-8" id="ESBDetailForm" data-ng-controller="myController" name="ESBDetailForm" onsubmit="return Form_validate()">
                                    <div class="msg" hidden style="margin-left:0;margin-right:0"> </div>
                                    <div class="msg_error" hidden style="margin-left:0;margin-right:0"> </div>
                                    <div class="table_grid" id="table_grid">
                                        @if (Model.sbillDetailsMultiple != null)
                                        {
                                            <div class='panel-heading navbar-inverse' style='color:white'>Carting Order Details</div>
                                            <table id=mytabl class='table table-striped table-bordered bootstrap-datatable'>
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th class=hide></th>
                                                        <th>
                                                            C.Order Date
                                                        </th>
                                                        <th>
                                                            C.Order No
                                                        </th>
                                                        <th>
                                                            S.Bill Date
                                                        </th>
                                                        <th>
                                                            S.Bill No
                                                        </th>
                                                        <th>
                                                            Product
                                                        </th>
                                                        <th>
                                                            Vehicle No
                                                        </th>
                                                        <th>
                                                            Unloaded Nop
                                                        </th>
                                                        <th>
                                                            Weight
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (pr_Search_ExportShippingAdmission_Multiple_Result det in Model.sbillDetailsMultiple)
                                                    {
                                                        <tr>
                                                            <td>
                                                                <input type='checkbox' name='CHKBX' class='CHKBX' id='CHKBX' onchange='SelectedCont(this)' />
                                                                <input type=text name='booltype' class='booltype hide' />
                                                            </td>
                                                            <td class=hide>
                                                                <input type=text id=GIDATE class=GIDATE name=GIDATE value="@det.GIDATE">
                                                                <input type=text id=GIDNO class=GIDNO name=GIDNO value="@det.GIDNO">
                                                                <input type=text id=SBDQTY class=SBDQTY name=SBDQTY value="@det.SBDQTY">
                                                                <input type=text id=SBMID class=SBMID name=SBMID value="@det.SBMID">
                                                                <input type=text id=ESBMID class=ESBMID name=ESBMID value="@det.ESBMID">
                                                                <input type="text" value="0" id="ESBMQTY" class="ESBMQTY" name="ESBMQTY" />
                                                                <input type="text" value="0" id="ESBDID" class="ESBDID" name="ESBDID" />
                                                                <input type="text" value="-" id="ESBDDPNAME" class="form-control hide ESBDDPNAME " name="ESBDDPNAME" />
                                                            </td>

                                                            <td class='col-lg-2'><input type=text id=SBMDATE value="@det.SBMDATE" class="form-control SBMDATE" name=SBMDATE readonly></td>
                                                            <td class='col-lg-2'><input type=text id=SBMDNO value="@det.SBMDNO" class="form-control SBMDNO" name=SBMDNO readonly></td>
                                                            <td class='col-lg-2'><input type=text id=SBMDATE value="@det.ESBMIDATE" class="form-control ESBMIDATE" name=ESBMIDATE readonly></td>
                                                            <td class='col-lg-2'><input type=text id=ESBMIDATE value="@det.ESBMDNO" class="form-control ESBMDNO" name="ESBMDNO" readonly></td>
                                                            <td class='col-lg-2'><input type=text id=PRDTDESC value="@det.PRDTDESC" class="form-control PRDTDESC" name=PRDTDESC readonly></td>
                                                            <td class='col-lg-3'><input type=text id=CONTNRNO value="@det.VHLNO" class='form-control VHLNO' name=VHLNO readonly></td>
                                                            <td class='col-lg-1'><input type=text id=SBDQTY value="@det.SBDQTY" class='SBDQTY form-control' name=SBDQTY readonly></td>
                                                            <td class='col-lg-1'><input type=text id=ESBMWGHT value="@det.ESBMWGHT" class='ESBMWGHT form-control' name=ESBMWGHT readonly></td>


                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        }


                                    </div>
                                    <fieldset id="ExportCartingOrder_info">
                                        <div class="row">
                                            <div class="col-md-12">

                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>Org. S.Bill No.<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBD_SBILLNO" class="form-control  ESBD_SBILLNO" name="ESBD_SBILLNO" onkeydown="return isAlphaNumberOnlyKey(event);" tabindex="5" />
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>Org. S.Bill Dt.<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBD_SBILLDATE" class="form-control  ESBD_SBILLDATE datepicker" name="ESBD_SBILLDATE" tabindex="6" />
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>Invoice No<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBOINVNO" class="form-control ESBOINVNO" name="ESBOINVNO" onkeydown="return isAlphaNumberOnlyKey(event);" tabindex="7" />
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>Invoice Date<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBOINVDATE" class="form-control  datepicker ESBOINVDATE" name="ESBOINVDATE" tabindex="8" />
                                                    </div>
                                                </div>


                                            </div>

                                            <div class="col-md-12">
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>Invoice Amount<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBOINVAMT" class="form-control ESBOINVAMT" name="ESBOINVAMT" onkeypress="return isNumberCommaDot(event)" tabindex="9" />
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>NOP<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBMNOP" class="form-control  ESBMNOP" name="ESBMNOP" onkeypress="return isNumberCommaDot(event)" tabindex="10" />

                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>FOB Value<span class="required-field"></span></label>
                                                        <input type="text" value="" id="ESBOINVFOBAMT" class="form-control  ESBOINVFOBAMT" name="ESBOINVFOBAMT" onkeypress="return isNumberCommaDot(event)" tabindex="7" />
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>New Exporter<span class="required-field"></span></label>
                                                        <input type="text" class="ESBMEXPRTNAME form-control" name="ESBMEXPRTNAME" id="ESBMEXPRTNAME" value="" data-autocomplete-url=@Url.Action("AutoExporter", "ExportShippingBillMaster") />
                                                        <input type="text" id="ESBMEXPRTID" class="form-control ESBMEXPRTID hidden" name="ESBMEXPRTID" value="0" readonly="readonly" />

                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Destination<span class="required-field"></span></label>
                                                        <input type="text" value="" id="DESTINATION" class="form-control  DESTINATION" name="DESTINATION"  tabindex="10" />

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="clearfix"> </div>


                                            <div class="col-md-12 box-footer">


                                                <input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs pull-left" onclick="JavaScript:history.back()" />

                                                <input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs" id="save" tabindex="5000" />


                                            </div>
                                        </div>
                                    </fieldset>
                                </form>
                            </div>


                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="col-lg-12">

    <!-- /.modal-content -->
</div>


<script type="text/javascript" src="~/Scripts/CommonValidation.js"></script>
<script>
    $(document).ready(function () {
        add_autocomplete($("#CHANAME"), "CHANAME,CHAID");//---AutoComplete function for CHANAME-----
        add_autocomplete($("#EXPRTNAME"), "EXPRTNAME,EXPRTID");
        add_autocomplete_exp($("#ESBMEXPRTNAME"), "ESBMEXPRTNAME,ESBMEXPRTID");

        $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', });
        $('.datetime').datetimepicker({
            dateFormat: 'dd/mm/yy',
            timeFormat: 'hh:mm'
        });
        $(".datepicker").removeAttr('fromDt').removeClass('hasDatepicker');
        $(".datepicker").removeAttr('toDt').removeClass('hasDatepicker');
        $("#fromDt").datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            numberOfMonths: 3,
            dateFormat: 'dd-mm-yy',
            onClose: function (selectedDate) {
                $("#toDt").datepicker("option", "minDate", selectedDate);
            }
        });
        $("#toDt").datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            numberOfMonths: 3,
            dateFormat: 'dd-mm-yy',
            onClose: function (selectedDate) {
                $("#fromDt").datepicker("option", "maxDate", selectedDate);
            }
        });

        $(window).bind("load", function () {
            if ($(".ESBDID").val() == "") {
                $(".ESBDID").val("0");
            }
        });



    });
    function SelectedCont(obj) {
        var i = 0;
        //alert('test');
        $(".CHKBX").each(function () {
            if ($(this).is(':Checked') == true) {
                $(".booltype")[i].value = "true";

            }
            else {
                $(".booltype")[i].value = "false";
            }
            i++;
        })
    }
    function GetMSBDetail() {
        var chaid = $("#CHAID").val();
        var exprtid = $("#EXPRTID").val();
        var sdate = $("#fromDt").val();
        var edate = $("#toDt").val();
        if ($("#sdate").val() == "") {
            alert('Please select From Date');
            $("#sdate").focus();
            return false;
        }
        if ($("#toDt").val() == "") {
            alert('Please select To Date');
            $("#toDt").focus();
            return false;
        }
        if ($("#EXPRTNAME").val() == "") {
            alert('Please select EXPORTER');
            $("#EXPRTNAME").focus();
            return false;
        }
        if ($("#EXPRTID").val() == "" || $("#EXPRTID").val() == "0") {
            alert('Please select EXPORTER');
            $("#EXPRTNAME").focus();
            return false;
        }
        if ($("#CHANAME").val() == "") {
            alert('Please select CHA');
            $("#CHANAME").focus();
            return false;
        }
        if ($("#CHAID").val() == "" || $("#CHAID").val() == "0") {
            alert('Please select CHA');
            $("#CHANAME").focus();
            return false;
        }


        //sdate = sdate.split(" "); sdate = sdate[0].split("/"); sdate = sdate[0] + (sdate[1].length < 2 ? '0' : '') + sdate[1] + "-" + "-" +sdate[2];
        ///edate = edate.split(" "); edate = edate[0].split("/"); edate = edate[0] + (edate[1].length < 2 ? '0' : '') + edate[1] + "-" + "-" + edate[2];
        url = "/ExportCartingOrder/sbdMultipleDetail?ids=" + sdate + "~" + edate + "~" + chaid + "~" + exprtid;// alert(url);
        $.ajax({
            url: url,
            success: function (data) {
                //  alert(data);
                $("#table_grid").html("");

                $("#table_grid").html(data);

            }
        });
    }
    function checkall() {
        i = 0; j = 0;
        CHCK_ALL = $("#CHCK_ALL").is(':checked');
        var tbl = $("#TDETAIL").find('tbody');
        // alert(CHCK_ALL);

        $(".CHKBX").each(function () {
            $trcur = tbl.find("tr:eq(" + i + ")");
            if (CHCK_ALL == true) {
                $trcur.find(".CHKBX").prop("checked", true);
                $(".booltype")[i].value = "true";
            }
            else {
                $trcur.find(".CHKBX").removeAttr("checked", true);
                $(".booltype")[i].value = "false";
            }

            i++;

        });

    }/*.....*/

    $('#EXPRTNAME').on('blur', function () {

        $('#ESBMEXPRTNAME').val($('#EXPRTNAME').val());
        $('#ESBMEXPRTID').val($('#EXPRTID').val());

    });

    function add_autocomplete_exp($obj, controls) {
        var oldFn = $.ui.autocomplete.prototype._renderItem;
        $.ui.autocomplete.prototype._renderItem = function (ul, item) {
            var re = new RegExp(this.term, "i");
            var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
            return $("<li></li>")
                .data("item.autocomplete", item)
                .append("<a>" + t + "</a>")
                .appendTo(ul);
        };

        $obj.autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: $obj.data("autocomplete-url"),
                    type: "POST",
                    dataType: "json",
                    data: {
                        term: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            count = 0;
                            item_str = "";
                            var jsonArg = new Object();
                            count = 0;
                            $.each(item, function (i, data) {
                                switch (count) {
                                    case 0:
                                        jsonArg.label = data;
                                        jsonArg.value = data;
                                        break;
                                    case 1:
                                        jsonArg.id = data;
                                        break;
                                    case 2:
                                        jsonArg.desc = data;
                                        break;
                                    case 3:
                                        jsonArg.xparam1 = data;
                                        break;
                                    case 4:
                                        jsonArg.xparam2 = data;
                                        break;
                                    case 5:
                                        jsonArg.xparam3 = data;
                                        break
                                }
                                count++
                            });
                            return jsonArg
                        }))
                    }
                })
            },
            search: function () {
                count = 0;
                $.each(controls.split(','), function (index, value) {
                    switch (count) {
                        case 0: break;
                        default:
                            $("#" + value).val(""); break;
                    } count++;
                })
                var term = extractLast(this.value);
                if (term.length < 2) {
                    return false
                }
            },
            select: function (event, ui) {
                $(this).val(ui.item.label);
                count = 0;
                $.each(controls.split(','), function (index, value) {
                    switch (count) {
                        case 1:
                            $("#" + value).val(ui.item.id);
                            break;
                        case 2:
                            $("#" + value).val(ui.item.desc);
                            break;
                        case 3:
                            $("#" + value).val(ui.item.xparam1);
                            break;
                        case 4:
                            $("#" + value).val(ui.item.xparam2);
                            break;
                        case 5:
                            $("#" + value).val(ui.item.xparam3);
                            break
                    }
                    count++
                    $("#ESBMEXPRTID").val(ui.item.id);
                });


                return false
            },
            change: function (event, ui) {
                //debugger;
                var opt = $(this).val();
                var crntval = event.currentTarget.value;
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    url: $obj.data("autocomplete-url"),
                    data: "{'term':'" + crntval + "'}",
                    dataType: 'json',
                    success: function (data) {
                        //debugger;
                        //console.log(data);
                        //alert(data);
                        if (data.length == 0) {
                            // $(event.currentTarget).val('');
                            alert('Select item from the list.');

                            $("#ESBMEXPRTNAME").focus();
                            $("#ESBMEXPRTID").val("0");
                        }
                        else { }
                    },
                    error: function (data) {
                        $(event.currentTarget).val('');

                        $("#ESBMEXPRTNAME").val();
                        $("#ESBMEXPRTID").val("0");
                        console.log('Error retrieving options.');
                    }
                });
            },
            messages: {
                noResults: "",
                results: ""
            }
        })
    }

    function Form_validate() {
        //alert('validate');
        flag = true;

        var badi = 0;
        $(".CHKBX").each(function () {
            if ($(this).is(':Checked') == true) {
                flag = true;
                badi++;
            }
            else {
                flag = false;
            }
        })
        flag = true;
        if (badi == 0) {
            alert("Please check the Carting Order Details !!");
            $(".CHKBX").focus();
            flag = false;
        }
        else if ($('.ESBD_SBILLNO').val() == "") {
            alert("Please enter Orginal S.Bill No !!");
            $('.ESBD_SBILLNO').focus();
            flag = false;
        }
        else if ($('.ESBD_SBILLDATE').val() == "") {
            alert("Please select Orginal S.Bill Date !!");
            $('.ESBD_SBILLDATE').focus();
            flag = false;
        }
        else if ($('.ESBOINVNO').val() == "") {
            alert("Please enter Invoice No !!");
            $('.ESBOINVNO').focus();
            flag = false;
        }
        else if ($('.ESBOINVDATE').val() == "") {
            alert("Please select Invoice Date !!");
            $('.ESBOINVDATE').focus();
            flag = false;
        }

        else if ($('.ESBOINVAMT').val() == "" || $('.ESBOINVAMT').val() == "0") {
            alert("Please enter  Invoice Amount !!");
            $('.ESBOINVAMT').focus();
            flag = false;
        }
        else if ($('.ESBMNOP').val() == "" || $('.ESBMNOP').val() == "0") {
            alert("Please enter NOP !!");
            $('.ESBMNOP').focus();
            flag = false;
        }
        else if ($('.ESBOINVFOBAMT').val() == "" || $('.ESBOINVFOBAMT').val() == "0") {
            alert("Please enter FOB Value !!");
            $('.ESBOINVFOBAMT').focus();
            flag = false;
        }
        else if ($('.ESBMEXPRTNAME').val() == "") {
            alert("Please select exporter !!");
            $('.ESBMEXPRTNAME').focus();
            flag = false;
        }
        else if ($('.ESBMEXPRTID').val() == "" || $('.ESBMEXPRTID').val() == "0") {
            alert("Please enter exporter !!");
            $('.ESBMEXPRTNAME').focus();
            flag = false;
        }
        else if ($('.ESBMDestination').val() == "" || $('.ESBMDestination').val() == "0") {
            alert("Please enter Destination !!");
            $('.ESBMDestination').focus();
            flag = false;
        }

        return flag;
    }
</script>






