
@using scfs_erp.Models;
@model scfs_erp.Models.GateInDetail

@{
    ViewBag.Title = "Import Gate IN";
}

<link href="~/Content/Site.css" type="text/css" rel="stylesheet" />

<style>
    .frm_hide {
        display: none;
    }

    #sidebar {
        display: none;
    }

    #main-content {
        margin-left: auto;
    }

    .gclr {
        font-weight: bold;
        color:red;
    }

    .api-updated {
        border-color: #f0ad4e !important;
        box-shadow: 0 0 6px rgba(240, 173, 78, 0.6);
        background-color: #fff9ef !important;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }
</style>
<section id="main-content">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-12">
                <div class="box">
                    <div class="box-header">
                        <div class="box-name">
                            <i class="glyphicon glyphicon-import"></i>
                            <strong>Import Gate In</strong>
                        </div>
                    </div>@Html.Raw(ViewBag.msg)
                    <div class="box-content" data-ng-app="myModule">
                        <form action="@Url.Content("~/ImportGateIn/saveidata")" method="post" accept-charset="utf-8" id="gateinform" data-ng-controller="myController" name="gateinform" onsubmit="return escord()">
                            <fieldset id="GateInForm_info">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-12">
                                            <div class="col-md-3 hidden">
                                                <div class="form-group">
                                                    <label>Primary</label>
                                                    @Html.TextBoxFor(model => Model.GIDID, new { @class = " form-control  GIDID", @id = "GIDID" })
                                                    @Html.TextBoxFor(model => Model.RGIDID, new { @class = " form-control  RGIDID", @id = "RGIDID" })
                                                    <input type="text" class="R_GIDID" id="R_GIDID" name="R_GIDID" value="@Model.RGIDID">
                                                    <input type="text" id="UsrAdmGrpChk" name="UsrAdmGrpChk" class="form-control UsrAdmGrpChk hide" value="@System.Web.HttpContext.Current.Session["AdminGrp"]">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>In Date<span class="required-field"></span> </label>

                                                    @Html.TextBoxFor(model => Model.GIDATE, "{0:dd/MM/yyyy}", new { @class = "form-control GIDATE", @id = "GIDATE", @data_val = false, @tabindex = "1", @placeholder = "Please Select Date" })

                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>In Time<span class="required-field"></span> </label>
                                                    @Html.TextBoxFor(model => Model.GITIME, "{0:HH:mm:ss}", new { @class = "form-control GITIME", @id = "GITIME", @data_val = false, tabindex = "1" })
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Port Out Date<span class="required-field"></span></label>

                                                    @Html.TextBoxFor(model => Model.GICCTLDATE, "{0:dd/MM/yyyy}", new { @class = "form-control GICCTLDATE", @id = "GICCTLDATE", @data_val = false, @tabindex = "1", @placeholder = "Please Select Date" })

                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Port Out Time<span class="required-field"></span></label>

                                                    @Html.TextBoxFor(model => Model.GICCTLTIME, "{0:HH:mm:ss}", new { @class = "form-control GICCTLTIME", @id = "GICCTLTIME", @data_val = false, tabindex = "2" })
                                                </div>
                                            </div>
                                            <div class="col-md-2 hidden">
                                                <div class="form-group">
                                                    <label>Gate In No<span class="required-field"></span> </label>
                                                    @Html.TextBoxFor(model => Model.GINO, new { @class = "form-control  GINO", @id = "GINO", @readonly = true, tabindex = "3" })
                                                </div>
                                            </div>
                                            <div class="col-md-2 hidden">
                                                <div class="form-group">
                                                    <label>No<span class="required-field"></span> </label>
                                                    @Html.TextBoxFor(model => Model.GIDNO, new { @class = "form-control  GIDNO", @id = "GIDNO", @readonly = true, tabindex = "4" })
                                                    @Html.ValidationMessageFor(model => model.GIDNO)
                                                </div>
                                            </div>

                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Ref No </label>
                                                    @Html.TextBoxFor(model => Model.GPREFNO, new { @class = "form-control  GPREFNO", @id = "GPREFNO", tabindex = "6" })
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Driver Name<span class="required-field"></span> </label>@*@Html.ValidationMessageFor(model => model.DRVNAME)*@
                                                    @Html.TextBoxFor(model => Model.DRVNAME, new { @class = "form-control DRVNAME", @id = "DRVNAME", @required = "required", tabindex = "7", @maxlength = "100" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Port In Date<span class="required-field"></span> </label>
                                                    <input type="text" class="form-control datepicker NEWDATE1" id="NEWDATE1" name="NEWDATE1" data-val="false" tabindex="8" placeholder="Please Select Date" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Port In Time<span class="required-field"></span> </label>
                                                    <input type="text" class="form-control timepicker NEWTIME1" id="NEWTIME1" name="NEWTIME1" data-val="false" tabindex="9" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Vessel Arrival Date<span class="required-field"></span> </label>
                                                    <input type="text" class="form-control datepicker NEWDATE2" id="NEWDATE2" name="NEWDATE2" data-val="false" tabindex="10" placeholder="Please Select Date" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Vessel Arrival Time<span class="required-field"></span> </label>
                                                    <input type="text" class="form-control timepicker NEWTIME2" id="NEWTIME2" name="NEWTIME2" data-val="false" tabindex="11" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-12">

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Transpoter Name<span class="required-field"></span> </label>
                                                    @Html.TextBoxFor(model => Model.TRNSPRTNAME, new { @class = "form-control TRNSPRTNAME", @id = "TRNSPRTNAME", @required = "required", tabindex = "8", data_autocomplete_url = Url.Action("AutoTransporter", "ImportGateIn"), @placeholder = "---Please Select----" })
                                                    @Html.TextBoxFor(model => Model.TRNSPRTID, new { @class = "hide form-control TRNSPRTID", @id = "TRNSPRTID" })
                                                </div>
                                            </div>
                                            <div class="col-md-4" id="othertransdiv">
                                                <div class="form-group">
                                                    <label>Other Transpoter Name</label>
                                                    @Html.TextBoxFor(model => Model.GTRNSPRTNAME, new { @class = "form-control GTRNSPRTNAME", @id = "GTRNSPRTNAME", @required = "required", tabindex = "9" })
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Vehicle No<span class="required-field"></span></label>
                                                    <div class="VHL_DIV">
                                                        @Html.TextBoxFor(model => Model.VHLNO, new { @class = "form-control VHLNO", @id = "VHLNO", @required = "required", tabindex = "10", data_autocomplete_url = Url.Action("AutoVehicleNo", "ImportGateIn"), @onchange = "CheckVehicle(this,GIDID)", @onkeydown = "return isAlphaNumberOnlyKey(event);", @maxlength = "15" })
                                                        @Html.TextBoxFor(model => Model.VHLMID, new { @class = "form-control  VHLMID hide", @id = "VHLMID", tabindex = "10" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>PNR No<span class="required-field"></span> </label>
                                                    @Html.TextBoxFor(model => Model.GPNRNO, new { @class = "form-control  GPNRNO", @id = "GPNRNO", @required = "required", tabindex = "-1", @readonly = "readonly", @onkeydown = "return isAlphaNumberOnlyKey(event);", @maxlength = "15" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-primary" id="job_list">
                                                <div class="panel-heading navbar-inverse">
                                                    Vessel / Container Details
                                                </div>
                                                <div class="panel-body">
                                                    <div class="col-md-12">
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label>Vessel Name<span class="required-field"></span> </label>
                                                                @Html.TextBoxFor(model => Model.VSLNAME, new { @class = "form-control VSLNAME", @id = "VSLNAME", data_autocomplete_url = Url.Action("AutoVessel", "ImportGateIn"), @required = "required", @placeholder = "---Please Select----", tabindex = "-1" })
                                                                @Html.TextBoxFor(model => Model.VSLID, new { @class = " hide form-control VSLID", @id = "VSLID" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label>Voyage No<span class="required-field"></span> </label>
                                                                @Html.TextBoxFor(model => Model.VOYNO, new { @class = "form-control  VOYNO", @id = "VOYNO", @required = "required", tabindex = "-1", @maxlength = "10", @onkeydown = "return isAlphaNumberOnlyKey(event);" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label>IGM No.<span class="required-field"></span>  </label>
                                                                @Html.TextBoxFor(model => Model.IGMNO, new { @class = "form-control  IGMNO", @id = "IGMNO", @required = "required", tabindex = "-1", @maxlength = "15" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label>Line No<span class="required-field"></span> </label>
                                                                @Html.TextBoxFor(model => Model.GPLNO, new { @class = "form-control  GPLNO", @id = "GPLNO", @required = "required", tabindex = "-1", @maxlength = "15" })
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <div class="col-md-12">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Importer Name<span class="required-field"></span> </label>
                                                                @Html.TextBoxFor(model => Model.IMPRTNAME, new { @class = "form-control IMPRTNAME", @id = "IMPRTNAME", data_autocomplete_url = Url.Action("AutoImpoter", "ImportGateIn"), @required = "required", @placeholder = "---Please Select----", tabindex = "-1" })
                                                                @Html.TextBoxFor(model => Model.IMPRTID, new { @class = "hide form-control IMPRTID", @id = "IMPRTID" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Steamer Name<span class="required-field"></span> </label>
                                                                @Html.TextBoxFor(model => Model.STMRNAME, new { @class = "form-control STMRNAME", @id = "STMRNAME", data_autocomplete_url = Url.Action("AutoSteamer", "ImportGateIn"), @required = "required", @placeholder = "---Please Select----", tabindex = "-1" })
                                                                @Html.TextBoxFor(model => Model.STMRID, new { @class = "hide form-control STMRID", @id = "STMRID" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-12 hide">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>CHA Name </label>
                                                                @Html.TextBoxFor(model => Model.CHANAME, new { @class = "form-control CHANAME", @id = "CHANAME", data_autocomplete_url = Url.Action("AutoChaName", "ImportGateIn"), @required = "required", @placeholder = "---Please Select----", tabindex = "-1" })
                                                                @Html.TextBoxFor(model => Model.CHAID, new { @class = "hide form-control CHAID", @id = "CHAID" })
                                                                @Html.TextBoxFor(model => Model.BCHAID, new { @class = "hide form-control BCHAID", @id = "BCHAID" })
                                                                @Html.TextBoxFor(model => Model.BCHANAME, new { @class = "hide form-control BCHANAME", @id = "BCHANAME" })
                                                                @Html.TextBoxFor(model => Model.EXPRTRID, new { @class = "hide form-control EXPRTRID", @id = "EXPRTRID" })
                                                                @Html.TextBoxFor(model => Model.EXPRTRNAME, new { @class = "hide form-control EXPRTRNAME", @id = "EXPRTRNAME" })
                                                                @Html.TextBoxFor(model => Model.UNITID, new { @class = "hide form-control UNITID", @id = "UNITID" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label>Bill of Entry No</label>
                                                                @Html.TextBoxFor(model => Model.BOENO, new { @class = "form-control BOENO", @id = "BOENO", tabindex = "-1", @maxlength = "50" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label>Bill of Entry Date </label>
                                                                @Html.TextBoxFor(model => Model.BOEDATE, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker BOEDATE", @id = "BOEDATE", tabindex = "-1" })

                                                            </div>
                                                        </div>

                                                    </div>

                                                    <div class="col-md-12">
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Container No<span class="required-field"></span></label>@*@Html.ValidationMessageFor(model => model.CONTNRNO)*@
                                                                @Html.TextBoxFor(model => Model.CONTNRNO, new { @class = "form-control  CONTNRNO", @id = "CONTNRNO", @required = "required", tabindex = "-1", @onchange = "CheckContr(CONTNRNO,this)", @maxlength = "15" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Size<span class="required-field"></span> </label>@*@Html.ValidationMessageFor(model => model.CONTNRSID)*@
                                                                @Html.DropDownList("CONTNRSID", null, "Select", new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Type<span class="required-field"></span> </label>@*@Html.ValidationMessageFor(model => model.CONTNRTID)*@
                                                                @Html.DropDownList("CONTNRTID", null, "Select", new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>ISO Code<span class="required-field"></span></label>
                                                                @Html.TextBoxFor(model => Model.GIISOCODE, new { @class = "form-control  GIISOCODE", @id = "GIISOCODE", tabindex = "-1", @required = "required", @maxlength = "10", @onkeydown = "return isAlphaNumberOnlyKey(event);" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>L.seal no<span class="required-field"></span></label>
                                                                @Html.TextBoxFor(model => Model.LPSEALNO, new { @class = "form-control  LPSEALNO", @id = "LPSEALNO", tabindex = "11", @maxlength = "50", @onkeydown = "return isAlphaNumberOnlyKey(event);" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>C.seal no<span class="required-field"></span></label>
                                                                @Html.TextBoxFor(model => Model.CSEALNO, new { @class = "form-control  CSEALNO", @id = "CSEALNO", tabindex = "12", @maxlength = "15", @onkeydown = "return isAlphaNumberOnlyKey(event);" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Refer(Plug)</label>@*@Html.ValidationMessageFor(model => model.GPETYPE)*@
                                                                @Html.DropDownList("GRADEID", null, new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>SSR/Escort</label>@*@Html.ValidationMessageFor(model => model.GPETYPE)*@
                                                                @Html.DropDownList("GPETYPE", null, new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label class="gclr">S.Amend / Mismatch</label>@*@Html.ValidationMessageFor(model => model.GPSTYPE)*@
                                                                @Html.DropDownList("GPSTYPE", null, new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>SSR/Escort Amount </label>
                                                                @Html.TextBoxFor(model => Model.GPEAMT, new { @class = "form-control  GPEAMT", @id = "GPEAMT", tabindex = "-1", @onkeypress = "return isNumberCommaDot(event)" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Addtnl. Amount </label>
                                                                @Html.TextBoxFor(model => Model.GPAAMT, new { @class = "form-control  GPAAMT", @id = "GPAAMT", tabindex = "-1", @onkeypress = "return isNumberCommaDot(event)" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label class="gclr">Scanned</label>
                                                                @Html.DropDownList("GPSCNTYPE", null, "Please select", new { @class = "form-control GPSCNTYPE", @id = "GPSCNTYPE", @onchange = "GetScanTypeChange()", tabindex = "-1" })
                                                            </div>
                                                        </div>

                                                        <div class="col-md-2" id="sc_credit">
                                                            <div class="form-group">
                                                                <label class="gclr">Scan Type</label>
                                                                @Html.DropDownList("GPSCNMTYPE", null, "Please select", new { @class = "form-control GPSCNMTYPE", @id= "GPSCNMTYPE", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-primary" id="job_list">
                                                <div class="panel-heading navbar-inverse">
                                                    Product Details
                                                </div>
                                                <div class="panel-body">
                                                    <div class="col-md-12">


                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Product Category<span class="required-field"></span> </label>
                                                                @Html.DropDownList("PRDTGID", null, "Please select an option", new { @class = "form-control", @required = "required", tabindex = "13" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label>Product Description<span class="required-field"></span> </label>
                                                                @Html.TextBoxFor(model => Model.PRDTDESC, new { @class = "form-control  PRDTDESC", @id = "PRDTDESC", @required = "required", tabindex = "-1", @maxlength = "100" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Weightment</label>
                                                                @Html.DropDownList("GPWTYPE", null, new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Weight</label>
                                                                @Html.TextBoxFor(model => Model.GPWGHT, new { @class = "form-control  GPWGHT", @id = "GPWGHT", tabindex = "-1", @onkeypress = "return isNumberCommaDot(event)" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-primary" id="job_list">
                                                <div class="panel-heading navbar-inverse">
                                                    Other Details
                                                </div>
                                                <div class="panel-body">

                                                    <div class="col-md-12">
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Port<span class="required-field"></span></label>
                                                                @Html.DropDownList("GPPTYPE", null, "Please select", new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>

                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>IGM Date </label>
                                                                @Html.TextBoxFor(model => Model.IGMDATE, "{0:dd/MM/yyyy}", new { @class = "form-control IGMDATE", @id = "IGMDATE", @data_val = false, @tabindex = "-1", @placeholder = "Please Select Date" })
                                                                @*@Html.TextBoxFor(model => Model.IGMDATE, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker IGMDATE", @id = "IGMDATE", @data_val = false, tabindex = "35" })*@
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>BL No. </label>
                                                                @Html.TextBoxFor(model => Model.BLNO, new { @class = "form-control  BLNO", @id = "BLNO", @maxlength = "20", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>FCL</label>@*@Html.ValidationMessageFor(model => model.GFCLTYPE)*@
                                                                @Html.DropDownList("GFCLTYPE", null, "Please select", new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Damage</label>
                                                                @Html.TextBoxFor(model => Model.GIDMGDESC, new { @class = "form-control  GIDMGDESC", @id = "GIDMGDESC", tabindex = "13" })
                                                            </div>
                                                        </div>


                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>GP Mode<span class="required-field"></span> </label>@Html.ValidationMessageFor(model => model.GPMODEID)
                                                                @Html.DropDownList("GPMODEID", null, "Select Mode", new { @class = "form-control", @required = "required", @tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Row<span class="required-field"></span></label>
                                                                @Html.DropDownList("ROWID", null, "Please select", new { @class = "form-control", @required = "required", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label>Slot<span class="required-field"></span> </label>
                                                                @Html.DropDownList("SLOTID", null, "Please select", new { @class = "form-control", tabindex = "-1" })
                                                            </div>
                                                        </div>
                                                        @*<div class="col-md-2">
                                <div class="form-group">
                                    <label>CFS Name </label>@Html.ValidationMessageFor(model => model.CFSNAME)
                                    @Html.TextBoxFor(model => Model.CFSNAME, new { @class = "form-control  CFSNAME", @id = "CFSNAME", tabindex = "41", @maxlength = "50" })

                                </div>
                            </div>*@
                                                        <div class="col-md-8">
                                                            <div class="form-group">
                                                                <label>Remarks  </label>@Html.ValidationMessageFor(model => model.GIREMKRS)
                                                                @Html.TextBoxFor(model => Model.GIREMKRS, new { @class = "form-control  GIREMKRS", @id = "GIREMKRS", tabindex = "14", @maxlength = "50" })

                                                            </div>
                                                        </div>
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-primary" id="job_list">
                                                <div class="panel-heading navbar-inverse">
                                                    License & Tax Information
                                                </div>
                                                <div class="panel-body">
                                                    <div class="col-md-12">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>License No</label>
                                                                <input type="text" class="form-control" id="LICENSENO" name="LICENSENO" tabindex="-1" maxlength="50" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>License Date</label>
                                                                <input type="text" class="form-control datepicker" id="LICENSEDATE" name="LICENSEDATE" tabindex="-1" placeholder="Please Select Date" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>PAN No</label>
                                                                <input type="text" class="form-control" id="PANNO" name="PANNO" tabindex="-1" maxlength="10" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>GST No</label>
                                                                <input type="text" class="form-control" id="GSTNO" name="GSTNO" tabindex="-1" maxlength="15" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>TIN No</label>
                                                                <input type="text" class="form-control" id="TINNO" name="TINNO" tabindex="-1" maxlength="15" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label>Tax ID</label>
                                                                <input type="text" class="form-control" id="TAXID" name="TAXID" tabindex="-1" maxlength="20" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    @*<div class="col-md-12"><fieldset style="width:100%"><legend style="font-size:medium">Product Details</legend></fieldset></div>*@



                                    <div class="col-md-12 box-footer">
                                        @*<input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs pull-left" onclick="JavaScript:history.back()" />*@
                                        <a href="@Url.Action("Index", "ImportGateIn")" class="btn btn-primary btn-xs  pull-left" onclick="javascript:return confirm('Are you sure you want to go back?')" tabindex="43">Go Back</a>
                                        <input type="button" name="apiRequest" value="API Request" id="btnApiRequest" class="btn btn-info btn-xs" tabindex="14" style="margin-left: 5px;" />
                                        <input type="button" name="save2" value="Submit" id="btnsave" class="btn btn-success btn-xs btnsave" tabindex="15" />
                                        <input type="text" name="gity" value="@System.Web.HttpContext.Current.Session["GTY"]" id="txtgity" class="hidden" />
                                        @*<input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs" id="save" tabindex="100" />*@

                                    </div>
                                    @if (Model != null)
                                    {
                                       
                                        <div class="Del_check hidden">@scfs_erp.Helper.Delete_fun.delete_check1("GATEINDETAIL", @Model.GIDID.ToString())</div>
                                    }
                                    <input type="text" id="txtGroup" class="form-control hide txtGroup" name="txtGroup" value="@System.Web.HttpContext.Current.Session["Group"]">

                                </div>

                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* LDB API Data - Hidden JSON for processing only (not displayed) *@
    @if (ViewBag.LdbData != null)
    {
        <script type="application/json" id="ldbDataJson" style="display: none;">@Html.Raw(ViewBag.LdbData)</script>
    }

    @* API Request Modal *@
    <div class="modal fade" id="apiRequestModal" tabindex="-1" role="dialog" aria-labelledby="apiRequestModalLabel">
        <div class="modal-dialog modal-lg" role="document" style="width: 90%; max-width: 1200px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="apiRequestModalLabel">API Request Data - Container: <span id="modalContainerNumber"></span></h4>
                </div>
                <div class="modal-body" style="min-height: 400px;">
                    <div id="apiLoading" style="text-align: center; padding: 40px;">
                        <i class="fa fa-spinner fa-spin fa-3x"></i>
                        <p style="margin-top: 15px;">Loading API data...</p>
                    </div>
                    <div id="apiError" style="display: none; color: red; padding: 20px; background-color: #ffe6e6; border: 1px solid #ff9999; border-radius: 4px;">
                        <strong>Error:</strong> <span id="apiErrorMessage"></span>
                    </div>
                    <div id="apiContent" style="display: none;">
                        <label style="font-weight: bold; margin-bottom: 10px; display: block;">API Response:</label>
                        <pre id="apiDataDisplay" style="max-height: 500px; overflow-y: auto; overflow-x: auto; background-color: #f5f5f5; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; color: #333; font-family: 'Courier New', monospace; font-size: 12px; border: 1px solid #ddd; margin: 0;"></pre>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script type="text/javascript" src="~/Scripts/CommonValidation.js"></script>

    <script>
        // Parse and process LDB API data (extract values for form fields)
        $(document).ready(function () {
            @if (ViewBag.LdbData != null)
            {
                <text>
                try {
                    var ldbDataJson = $('#ldbDataJson').text();
                    var ldbData = JSON.parse(ldbDataJson);

                    // Reset previous highlights
                    var highlightSelectors = ['#GIISOCODE', '#CONTNRNO', '#CONTNRSID', '#CONTNRTID', '#GPPTYPE', '#GICCTLDATE', '#GICCTLTIME', '#VSLNAME', '#NEWDATE1', '#NEWTIME1', '#NEWDATE2', '#NEWTIME2'];
                    highlightSelectors.forEach(function (sel) {
                        $(sel).removeClass('api-updated').removeAttr('title');
                    });

                    function highlightField(selector, fieldName, apiValue) {
                        var $el = $(selector);
                        if ($el.length) {
                            $el.addClass('api-updated');
                            if (apiValue !== undefined && apiValue !== null && apiValue !== '') {
                                $el.attr('title', fieldName + ' (API): ' + apiValue);
                            } else {
                                $el.removeAttr('title');
                            }
                        }
                    }
                    
                    // Extract and compare data from API response
                    try {
                        var apiData = {};
                        
                        // Try to get data from the JSON structure
                        // Path: response[0].response.eximContainerTrail.cntrDetail
                        if (ldbData && ldbData.response && Array.isArray(ldbData.response) && ldbData.response.length > 0) {
                            var firstResponse = ldbData.response[0];
                            if (firstResponse && firstResponse.response && firstResponse.response.eximContainerTrail) {
                                var eximTrail = firstResponse.response.eximContainerTrail;
                                if (eximTrail.cntrDetail) {
                                    var cntrDetail = eximTrail.cntrDetail;
                                    apiData.isoCode = cntrDetail.isocode ? cntrDetail.isocode.toString().trim() : null;
                                    apiData.containerNo = cntrDetail.cntrno ? cntrDetail.cntrno.toString().trim() : null;
                                    apiData.containerSize = cntrDetail.cntrsize ? cntrDetail.cntrsize.toString().trim() : null;
                                    apiData.containerType = cntrDetail.containertype ? cntrDetail.containertype.toString().trim() : null;
                                }
                                
                                function findPortOutEvent(events) {
                                    if (!events || !Array.isArray(events)) { return null; }
                                    var bestEvent = null;
                                    events.forEach(function (evt) {
                                        if (evt && evt.eventname && evt.eventname.toString().toUpperCase().indexOf('PORT OUT') !== -1) {
                                            if (!bestEvent) {
                                                bestEvent = evt;
                                            } else if (evt.timestamptimezone && (!bestEvent.timestamptimezone || evt.timestamptimezone > bestEvent.timestamptimezone)) {
                                                bestEvent = evt;
                                            }
                                        }
                                    });
                                    return bestEvent;
                                }

                                var portOutEvent = findPortOutEvent(eximTrail.last_event);
                                if (!portOutEvent) {
                                    portOutEvent = findPortOutEvent(eximTrail.trackLog);
                                }

                                if (portOutEvent && portOutEvent.timestamptimezone) {
                                    if (portOutEvent.currentlocation) {
                                        apiData.portLocation = portOutEvent.currentlocation.toString().trim();
                                    }
                                    var timestampStr = portOutEvent.timestamptimezone.toString().trim();
                                    if (timestampStr) {
                                        var parts = timestampStr.split(' ');
                                        if (parts.length >= 2) {
                                            apiData.portOutDate = parts[0];
                                            apiData.portOutTime = parts[1];
                                        }
                                    }
                                } else {
                                    console.log('PORT OUT event not found in last_event or trackLog');
                                }
                                
                                // Extract vessel name from vessel_eta array
                                if (eximTrail.vessel_eta && Array.isArray(eximTrail.vessel_eta) && eximTrail.vessel_eta.length > 0) {
                                    var vesselEta = eximTrail.vessel_eta[0];
                                    if (vesselEta && vesselEta.vesselname) {
                                        apiData.vesselName = vesselEta.vesselname.toString().trim();
                                        console.log('Vessel name extracted from vessel_eta: ' + apiData.vesselName);
                                    } else {
                                        console.log('vessel_eta[0] exists but vesselname is missing or null');
                                    }
                                } else {
                                    console.log('vessel_eta is null, not an array, or empty. vessel_eta:', eximTrail.vessel_eta);
                                }
                                
                                // Also try to find VESSEL ARRIVED event to get port (orgname) as fallback
                                function findVesselArrivedEvent(events) {
                                    if (!events || !Array.isArray(events)) { return null; }
                                    var bestEvent = null;
                                    events.forEach(function (evt) {
                                        if (evt && evt.eventname && evt.eventname.toString().toUpperCase().indexOf('VESSEL ARRIVED') !== -1) {
                                            if (!bestEvent) {
                                                bestEvent = evt;
                                            } else if (evt.timetimestamp && (!bestEvent.timetimestamp || evt.timetimestamp > bestEvent.timetimestamp)) {
                                                bestEvent = evt;
                                            }
                                        }
                                    });
                                    return bestEvent;
                                }
                                
                                var vesselArrivedEvent = findVesselArrivedEvent(eximTrail.trackLog);
                                if (!vesselArrivedEvent) {
                                    vesselArrivedEvent = findVesselArrivedEvent(eximTrail.last_event);
                                }
                                
                                if (vesselArrivedEvent) {
                                    // Extract port from orgname
                                    if (vesselArrivedEvent.orgname) {
                                        apiData.vesselPort = vesselArrivedEvent.orgname.toString().trim();
                                    }
                                } else {
                                    console.log('VESSEL ARRIVED event not found in trackLog or last_event');
                                }
                                
                                // Extract timestamp from last_event[0].timestamptimezone for Port In Date and Time
                                if (eximTrail.last_event && Array.isArray(eximTrail.last_event) && eximTrail.last_event.length > 0) {
                                    var firstEvent = eximTrail.last_event[0];
                                    if (firstEvent && firstEvent.timestamptimezone) {
                                        var timestampStr = firstEvent.timestamptimezone.toString().trim();
                                        console.log('Extracted timestamp from last_event[0]: ' + timestampStr);
                                        
                                        // Parse timestamp format: "2025-10-20 21:44:16"
                                        if (timestampStr) {
                                            var timestampParts = timestampStr.split(' ');
                                            if (timestampParts.length >= 2) {
                                                var datePart = timestampParts[0]; // "2025-10-20"
                                                var timePart = timestampParts[1]; // "21:44:16"
                                                
                                                // Convert date from "2025-10-20" to "20/10/2025" (dd/MM/yyyy)
                                                var dateParts = datePart.split('-');
                                                if (dateParts.length === 3) {
                                                    var formattedDate = dateParts[2] + '/' + dateParts[1] + '/' + dateParts[0]; // dd/MM/yyyy
                                                    
                                                    // Store in apiData for later use
                                                    apiData.date1 = formattedDate;
                                                    apiData.time1 = timePart;
                                                    
                                                    console.log('Port In Date: ' + formattedDate + ', Port In Time: ' + timePart);
                                                }
                                            }
                                        }
                                    } else {
                                        console.log('last_event[0] exists but timestamptimezone is missing or null');
                                    }
                                } else {
                                    console.log('last_event is null, not an array, or empty');
                                }
                                
                                // Extract timestamp from vessel_ata[0].timetimestamp for Vessel Arrival Date and Time
                                if (eximTrail.vessel_ata && Array.isArray(eximTrail.vessel_ata) && eximTrail.vessel_ata.length > 0) {
                                    var firstVesselAta = eximTrail.vessel_ata[0];
                                    if (firstVesselAta && firstVesselAta.timetimestamp) {
                                        var timestampStr = firstVesselAta.timetimestamp.toString().trim();
                                        console.log('Extracted timestamp from vessel_ata[0]: ' + timestampStr);
                                        
                                        // Parse timestamp format: "2025-10-09 12:00:00"
                                        if (timestampStr) {
                                            var timestampParts = timestampStr.split(' ');
                                            if (timestampParts.length >= 2) {
                                                var datePart = timestampParts[0]; // "2025-10-09"
                                                var timePart = timestampParts[1]; // "12:00:00"
                                                
                                                // Convert date from "2025-10-09" to "09/10/2025" (dd/MM/yyyy)
                                                var dateParts = datePart.split('-');
                                                if (dateParts.length === 3) {
                                                    var formattedDate = dateParts[2] + '/' + dateParts[1] + '/' + dateParts[0]; // dd/MM/yyyy
                                                    
                                                    // Store in apiData for later use
                                                    apiData.date2 = formattedDate;
                                                    apiData.time2 = timePart;
                                                    
                                                    console.log('Vessel Arrival Date: ' + formattedDate + ', Vessel Arrival Time: ' + timePart);
                                                }
                                            }
                                        }
                                    } else {
                                        console.log('vessel_ata[0] exists but timetimestamp is missing or null');
                                    }
                                } else {
                                    console.log('vessel_ata is null, not an array, or empty');
                                }
                            }
                        }
                        
                        // Helper function to update field and show notification
                        function updateField(fieldId, apiValue, fieldName, isDropdown) {
                            var formValue = $('#' + fieldId).val();
                            if (formValue) {
                                formValue = formValue.toString().trim();
                            }
                            var apiValueStr = apiValue != null ? apiValue.toString().trim() : apiValue;
                            highlightField('#' + fieldId, fieldName, apiValueStr);
                            
                            if (formValue !== apiValueStr) {
                                if (isDropdown) {
                                        $('#' + fieldId).val(apiValueStr).trigger('change');
                                } else {
                                    $('#' + fieldId).val(apiValueStr);
                                }
                                console.log(fieldName + ' updated from API. Form value: "' + formValue + '" -> API value: "' + apiValueStr + '"');
                                
                                if (formValue && formValue !== '') {
                                    return fieldName + ' mismatch: "' + formValue + '" -> "' + apiValueStr + '"';
                                } else {
                                    console.log(fieldName + ' populated from API (form was empty)');
                                    return null;
                                }
                            } else {
                                console.log(fieldName + ' matches. Form value: "' + formValue + '" = API value: "' + apiValueStr + '"');
                                return null;
                            }
                        }
                        
                        var mismatchMessages = [];
                        
                        // 1. Compare and update ISO Code
                        if (apiData.isoCode) {
                            var msg = updateField('GIISOCODE', apiData.isoCode, 'ISO Code', false);
                            if (msg) mismatchMessages.push(msg);
                        }
                        
                        // 2. Compare and update Container Number
                        if (apiData.containerNo) {
                            var msg = updateField('CONTNRNO', apiData.containerNo, 'Container Number', false);
                            if (msg) mismatchMessages.push(msg);
                        }
                        
                        // 3. Compare and update Container Size (dropdown)
                        if (apiData.containerSize) {
                            // Find dropdown option that matches the size
                            var sizeMatched = false;
                            var apiSizeNum = parseInt(apiData.containerSize);
                            
                            $('#CONTNRSID option').each(function() {
                                var optionText = $(this).text().toString().trim();
                                var optionValue = $(this).val();
                                
                                // Check if option text contains the size number (e.g., "20", "40", "45")
                                // Also check if the value itself matches the size number
                                var optionTextNum = parseInt(optionText);
                                if ((!isNaN(optionTextNum) && optionTextNum === apiSizeNum) || 
                                    optionText.indexOf(apiData.containerSize) !== -1 || 
                                    optionValue === apiData.containerSize ||
                                    parseInt(optionValue) === apiSizeNum) {
                                    var formSize = $('#CONTNRSID').val();
                                    var formSizeText = $('#CONTNRSID option:selected').text();
                                    
                                    var sizeDisplayText = optionText;
                                    if (formSize !== optionValue) {
                                        $('#CONTNRSID').val(optionValue).trigger('change');
                                        formSizeText = $('#CONTNRSID option:selected').text();
                                        sizeDisplayText = formSizeText;
                                        console.log('Container Size updated from API. Form value: "' + formSizeText + '" -> API value: "' + apiData.containerSize + '"');
                                        
                                        if (formSize && formSize !== '') {
                                            mismatchMessages.push('Container Size mismatch: "' + formSizeText + '" -> "' + apiData.containerSize + '"');
                                        }
                                    } else {
                                        console.log('Container Size matches. Form value: "' + optionText + '" = API value: "' + apiData.containerSize + '"');
                                    }
                                    highlightField('#CONTNRSID', 'Container Size', sizeDisplayText);
                                    sizeMatched = true;
                                    return false; // break
                                }
                            });
                            
                            if (!sizeMatched) {
                                console.log('Container Size "' + apiData.containerSize + '" not found in dropdown options');
                            }
                        }
                        
                        // 4. Compare and update Container Type (dropdown)
                        if (apiData.containerType) {
                            // Find dropdown option that matches the type text
                            var typeMatched = false;
                            $('#CONTNRTID option').each(function() {
                                var optionText = $(this).text().toString().trim();
                                var optionValue = $(this).val();
                                
                                // Check if option text matches or contains the container type
                                if (optionText.toUpperCase().indexOf(apiData.containerType.toUpperCase()) !== -1 || 
                                    apiData.containerType.toUpperCase().indexOf(optionText.toUpperCase()) !== -1) {
                                    var formType = $('#CONTNRTID').val();
                                    var typeDisplayText = optionText;
                                    if (formType !== optionValue) {
                                        $('#CONTNRTID').val(optionValue).trigger('change');
                                        var formTypeText = $('#CONTNRTID option:selected').text();
                                        typeDisplayText = formTypeText;
                                        console.log('Container Type updated from API. Form value: "' + formTypeText + '" -> API value: "' + apiData.containerType + '"');
                                        
                                        if (formType && formType !== '') {
                                            mismatchMessages.push('Container Type mismatch: "' + formTypeText + '" -> "' + apiData.containerType + '"');
                                        }
                                    } else {
                                        console.log('Container Type matches. Form value: "' + optionText + '" = API value: "' + apiData.containerType + '"');
                                    }
                                    highlightField('#CONTNRTID', 'Container Type', typeDisplayText);
                                    typeMatched = true;
                                    return false; // break
                                }
                            });
                            
                            if (!typeMatched) {
                                console.log('Container Type "' + apiData.containerType + '" not found in dropdown options');
                            }
                        }

                        // 5. Compare and update Port (dropdown) - from PORT OUT event
                        if (apiData.portLocation) {
                            var portMatched = false;
                            var apiPortText = apiData.portLocation.toUpperCase();
                            $('#GPPTYPE option').each(function () {
                                var optionText = $(this).text().toString().trim();
                                var optionValue = $(this).val();
                                if (!optionText) { return; }
                                var optionTextUpper = optionText.toUpperCase();
                                if (apiPortText.indexOf(optionTextUpper) !== -1 || optionTextUpper.indexOf(apiPortText) !== -1) {
                                    var formPort = $('#GPPTYPE').val();
                                    var formPortText = $('#GPPTYPE option:selected').text();
                                    if (formPort !== optionValue) {
                                        $('#GPPTYPE').val(optionValue).trigger('change');
                                        var selectedText = $('#GPPTYPE option:selected').text();
                                        console.log('Port updated from API (PORT OUT). Form value: "' + formPortText + '" -> API value: "' + apiData.portLocation + '"');
                                        if (formPort && formPort !== '') {
                                            mismatchMessages.push('Port mismatch: "' + formPortText + '" -> "' + apiData.portLocation + '"');
                                        }
                                        highlightField('#GPPTYPE', 'Port', selectedText);
                                    } else {
                                        console.log('Port matches. Form value: "' + optionText + '" = API value: "' + apiData.portLocation + '"');
                                        highlightField('#GPPTYPE', 'Port', optionText);
                                    }
                                    portMatched = true;
                                    return false;
                                }
                            });
                            if (!portMatched) {
                                console.log('Port "' + apiData.portLocation + '" not found in dropdown options');
                            }
                        }
                        
                        // 5b. Compare and update Port (dropdown) - from VESSEL ARRIVED event (orgname) - takes priority
                        if (apiData.vesselPort) {
                            var vesselPortMatched = false;
                            var apiVesselPortText = apiData.vesselPort.toUpperCase();
                            $('#GPPTYPE option').each(function () {
                                var optionText = $(this).text().toString().trim();
                                var optionValue = $(this).val();
                                if (!optionText) { return; }
                                var optionTextUpper = optionText.toUpperCase();
                                // Match by checking if orgname contains port code or port code is in orgname
                                if (apiVesselPortText.indexOf(optionTextUpper) !== -1 || optionTextUpper.indexOf(apiVesselPortText) !== -1) {
                                    var formPort = $('#GPPTYPE').val();
                                    var formPortText = $('#GPPTYPE option:selected').text();
                                    if (formPort !== optionValue) {
                                        $('#GPPTYPE').val(optionValue).trigger('change');
                                        var selectedText = $('#GPPTYPE option:selected').text();
                                        console.log('Port updated from API (VESSEL ARRIVED). Form value: "' + formPortText + '" -> API value: "' + apiData.vesselPort + '"');
                                        if (formPort && formPort !== '') {
                                            mismatchMessages.push('Port mismatch: "' + formPortText + '" -> "' + apiData.vesselPort + '"');
                                        }
                                        highlightField('#GPPTYPE', 'Port', selectedText);
                                    } else {
                                        console.log('Port matches. Form value: "' + optionText + '" = API value: "' + apiData.vesselPort + '"');
                                        highlightField('#GPPTYPE', 'Port', optionText);
                                    }
                                    vesselPortMatched = true;
                                    return false;
                                }
                            });
                            if (!vesselPortMatched) {
                                console.log('Port "' + apiData.vesselPort + '" not found in dropdown options');
                            }
                        }
                        
                        // 5c. Compare and update Vessel Name (text field with autocomplete)
                        if (apiData.vesselName) {
                            var formVesselName = $('#VSLNAME').val();
                            if (formVesselName) {
                                formVesselName = formVesselName.toString().trim();
                            }
                            var apiVesselNameStr = apiData.vesselName.toString().trim();
                            
                            console.log('Processing Vessel Name from API. API value: "' + apiVesselNameStr + '", Form value: "' + formVesselName + '"');
                            
                            highlightField('#VSLNAME', 'Vessel Name', apiVesselNameStr);
                            
                            if (formVesselName !== apiVesselNameStr) {
                                // Search for the vessel in autocomplete source and set it properly
                                var vesselAutocompleteUrl = $('#VSLNAME').data('autocomplete-url');
                                console.log('Vessel autocomplete URL: ' + vesselAutocompleteUrl);
                                
                                if (vesselAutocompleteUrl) {
                                    $.ajax({
                                        url: vesselAutocompleteUrl,
                                        type: "POST",
                                        dataType: "json",
                                        data: { term: apiVesselNameStr },
                                        success: function (data) {
                                            console.log('Autocomplete search response for "' + apiVesselNameStr + '":', data);
                                            var vesselMatched = false;
                                            if (data && data.length > 0) {
                                                // Try to find exact match first
                                                for (var i = 0; i < data.length; i++) {
                                                    var item = data[i];
                                                    var itemLabel = '';
                                                    var itemId = '';
                                                    
                                                    // Parse the autocomplete response format
                                                    if (Array.isArray(item)) {
                                                        itemLabel = item[0] ? item[0].toString().trim() : '';
                                                        itemId = item[1] ? item[1].toString().trim() : '';
                                                    } else if (item.label) {
                                                        itemLabel = item.label.toString().trim();
                                                        itemId = item.id ? item.id.toString().trim() : '';
                                                    } else if (item.VSLDESC) {
                                                        itemLabel = item.VSLDESC.toString().trim();
                                                        itemId = item.VSLID ? item.VSLID.toString().trim() : '';
                                                    }
                                                    
                                                    console.log('Checking autocomplete item: label="' + itemLabel + '", id="' + itemId + '"');
                                                    
                                                    // Check for exact or close match
                                                    if (itemLabel.toUpperCase() === apiVesselNameStr.toUpperCase() || 
                                                        itemLabel.toUpperCase().indexOf(apiVesselNameStr.toUpperCase()) !== -1 ||
                                                        apiVesselNameStr.toUpperCase().indexOf(itemLabel.toUpperCase()) !== -1) {
                                                        // Disable autocomplete change validation temporarily
                                                        var $vslNameField = $('#VSLNAME');
                                                        var $vslIdField = $('#VSLID');
                                                        
                                                        // Unbind the change event that validates
                                                        $vslNameField.off('change');
                                                        
                                                        // Set both VSLNAME and VSLID
                                                        $vslNameField.val(itemLabel);
                                                        if (itemId) {
                                                            $vslIdField.val(itemId);
                                                        }
                                                        
                                                        // Re-bind change event after a delay
                                                        setTimeout(function() {
                                                            // The autocomplete will re-attach its handlers
                                                        }, 500);
                                                        
                                                        vesselMatched = true;
                                                        console.log('Vessel Name updated from API (matched in autocomplete). Form value: "' + formVesselName + '" -> API value: "' + itemLabel + '" (ID: ' + itemId + ')');
                                                        break;
                                                    }
                                                }
                                            }
                                            
                                            if (!vesselMatched) {
                                                // If no match found, set the value directly anyway
                                                var $vslNameField = $('#VSLNAME');
                                                // Unbind the change event that validates
                                                $vslNameField.off('change');
                                                $vslNameField.val(apiVesselNameStr);
                                                console.log('Vessel Name updated from API (no autocomplete match found, set directly). Form value: "' + formVesselName + '" -> API value: "' + apiVesselNameStr + '"');
                                                
                                                // Re-bind after delay
                                                setTimeout(function() {
                                                    // The autocomplete will re-attach its handlers
                                                }, 500);
                                            }
                                            
                                            if (formVesselName && formVesselName !== '') {
                                                mismatchMessages.push('Vessel Name mismatch: "' + formVesselName + '" -> "' + apiVesselNameStr + '"');
                                            } else {
                                                console.log('Vessel Name populated from API (form was empty)');
                                            }
                                        },
                                        error: function (xhr, status, error) {
                                            console.error('Autocomplete search error:', status, error);
                                            // If autocomplete search fails, set value directly
                                            var $vslNameField = $('#VSLNAME');
                                            $vslNameField.off('change');
                                            $vslNameField.val(apiVesselNameStr);
                                            console.log('Vessel Name updated from API (autocomplete search failed, set directly). Form value: "' + formVesselName + '" -> API value: "' + apiVesselNameStr + '"');
                                            if (formVesselName && formVesselName !== '') {
                                                mismatchMessages.push('Vessel Name mismatch: "' + formVesselName + '" -> "' + apiVesselNameStr + '"');
                                            }
                                        }
                                    });
                                } else {
                                    // No autocomplete URL, set directly
                                    var $vslNameField = $('#VSLNAME');
                                    $vslNameField.off('change');
                                    $vslNameField.val(apiVesselNameStr);
                                    console.log('Vessel Name updated from API (no autocomplete URL). Form value: "' + formVesselName + '" -> API value: "' + apiVesselNameStr + '"');
                                    if (formVesselName && formVesselName !== '') {
                                        mismatchMessages.push('Vessel Name mismatch: "' + formVesselName + '" -> "' + apiVesselNameStr + '"');
                                    }
                                }
                            } else {
                                console.log('Vessel Name matches. Form value: "' + formVesselName + '" = API value: "' + apiVesselNameStr + '"');
                            }
                        } else {
                            console.log('apiData.vesselName is empty or null. apiData:', apiData);
                        }
                        
                        // 6. Compare and update Port Out Date/Time
                        if (apiData.portOutDate && apiData.portOutTime) {
                            // Convert date format from "2025-11-18" to "18/11/2025" (dd/MM/yyyy)
                            var dateParts = apiData.portOutDate.split('-');
                            if (dateParts.length === 3) {
                                var formattedDate = dateParts[2] + '/' + dateParts[1] + '/' + dateParts[0]; // dd/MM/yyyy
                                
                                var formPortOutDate = $('#GICCTLDATE').val();
                                var formPortOutTime = $('#GICCTLTIME').val();
                                
                                var dateUpdated = false;
                                var timeUpdated = false;
                                
                                if (formPortOutDate !== formattedDate) {
                                    $('#GICCTLDATE').val(formattedDate);
                                    dateUpdated = true;
                                    console.log('Port Out Date updated from API. Form value: "' + formPortOutDate + '" -> API value: "' + formattedDate + '"');
                                    if (formPortOutDate && formPortOutDate !== '') {
                                        mismatchMessages.push('Port Out Date mismatch: "' + formPortOutDate + '" -> "' + formattedDate + '"');
                                    }
                                }
                                
                                if (formPortOutTime !== apiData.portOutTime) {
                                    $('#GICCTLTIME').val(apiData.portOutTime);
                                    timeUpdated = true;
                                    console.log('Port Out Time updated from API. Form value: "' + formPortOutTime + '" -> API value: "' + apiData.portOutTime + '"');
                                    if (formPortOutTime && formPortOutTime !== '') {
                                        mismatchMessages.push('Port Out Time mismatch: "' + formPortOutTime + '" -> "' + apiData.portOutTime + '"');
                                    }
                                }

                        if (apiData.portOutDate || apiData.portOutTime) {
                            highlightField('#GICCTLDATE', 'Port Out Date', formattedDate);
                            highlightField('#GICCTLTIME', 'Port Out Time', apiData.portOutTime);
                        }
                                
                                if (!dateUpdated && !timeUpdated) {
                                    console.log('Port Out Date/Time matches. Form: "' + formPortOutDate + ' ' + formPortOutTime + '" = API: "' + formattedDate + ' ' + apiData.portOutTime + '"');
                                }
                            }
                        }
                        
                        // 7. Update Port In Date and Time from last_event[0].timestamptimezone
                        if (apiData.date1 && apiData.time1) {
                            var formDate1 = $('#NEWDATE1').val();
                            var formTime1 = $('#NEWTIME1').val();
                            
                            var date1Updated = false;
                            var time1Updated = false;
                            
                            if (formDate1 !== apiData.date1) {
                                $('#NEWDATE1').val(apiData.date1);
                                date1Updated = true;
                                console.log('Port In Date updated from API. Form value: "' + formDate1 + '" -> API value: "' + apiData.date1 + '"');
                                if (formDate1 && formDate1 !== '') {
                                    mismatchMessages.push('Port In Date mismatch: "' + formDate1 + '" -> "' + apiData.date1 + '"');
                                }
                            }
                            
                            if (formTime1 !== apiData.time1) {
                                $('#NEWTIME1').val(apiData.time1);
                                time1Updated = true;
                                console.log('Port In Time updated from API. Form value: "' + formTime1 + '" -> API value: "' + apiData.time1 + '"');
                                if (formTime1 && formTime1 !== '') {
                                    mismatchMessages.push('Port In Time mismatch: "' + formTime1 + '" -> "' + apiData.time1 + '"');
                                }
                            }
                            
                            if (apiData.date1 || apiData.time1) {
                                highlightField('#NEWDATE1', 'Port In Date', apiData.date1);
                                highlightField('#NEWTIME1', 'Port In Time', apiData.time1);
                            }
                            
                            if (!date1Updated && !time1Updated) {
                                console.log('Port In Date/Time matches. Form: "' + formDate1 + ' ' + formTime1 + '" = API: "' + apiData.date1 + ' ' + apiData.time1 + '"');
                            }
                        }
                        
                        // 8. Update Vessel Arrival Date and Time from vessel_ata[0].timetimestamp
                        if (apiData.date2 && apiData.time2) {
                            var formDate2 = $('#NEWDATE2').val();
                            var formTime2 = $('#NEWTIME2').val();
                            
                            var date2Updated = false;
                            var time2Updated = false;
                            
                            if (formDate2 !== apiData.date2) {
                                $('#NEWDATE2').val(apiData.date2);
                                date2Updated = true;
                                console.log('Vessel Arrival Date updated from API. Form value: "' + formDate2 + '" -> API value: "' + apiData.date2 + '"');
                                if (formDate2 && formDate2 !== '') {
                                    mismatchMessages.push('Vessel Arrival Date mismatch: "' + formDate2 + '" -> "' + apiData.date2 + '"');
                                }
                            }
                            
                            if (formTime2 !== apiData.time2) {
                                $('#NEWTIME2').val(apiData.time2);
                                time2Updated = true;
                                console.log('Vessel Arrival Time updated from API. Form value: "' + formTime2 + '" -> API value: "' + apiData.time2 + '"');
                                if (formTime2 && formTime2 !== '') {
                                    mismatchMessages.push('Vessel Arrival Time mismatch: "' + formTime2 + '" -> "' + apiData.time2 + '"');
                                }
                            }
                            
                            if (apiData.date2 || apiData.time2) {
                                highlightField('#NEWDATE2', 'Vessel Arrival Date', apiData.date2);
                                highlightField('#NEWTIME2', 'Vessel Arrival Time', apiData.time2);
                            }
                            
                            if (!date2Updated && !time2Updated) {
                                console.log('Vessel Arrival Date/Time matches. Form: "' + formDate2 + ' ' + formTime2 + '" = API: "' + apiData.date2 + ' ' + apiData.time2 + '"');
                            }
                        }
                        
                        // Values are updated silently without alert
                        if (mismatchMessages.length > 0) {
                            console.log('API values updated silently. Mismatches:', mismatchMessages.join(', '));
                        }
                        
                    } catch (dataError) {
                        console.error('Error comparing API data:', dataError);
                    }
                } catch (e) {
                    console.error('Error parsing LDB data:', e);
                }
                </text>
            }
        });
    </script>

    <script>

        $("#btnsave").click(function () {
            flag = true;
            if ($('#GIDATE').val() == "") {
                alert('Please Enter In Date !!');
                flag = false;
                $('#GIDATE').focus();
            }
            else if ($('#GITIME').val() == "") {
                alert('Please Enter In Time !!');
                flag = false;
                $('#GITIME').focus();
            }
            else if ($('#GICCTLDATE').val() == "") {
                alert('Please Enter CCTL Out Date !!');
                flag = false;
                $('#GICCTLDATE').focus();

            }
            else if ($('#GICCTLTIME').val() == "") {
                alert('Please Enter CCTL Out Time !!');
                flag = false;
                $('#GICCTLTIME').focus();

            }
            else if ($('#DRVNAME').val() == "") {
                alert('Please Enter Driver Name !!');
                flag = false;
                $('#DRVNAME').focus();
            }
            else if ($('#TRNSPRTNAME').val() == "") {
                alert('Please Select Transpoter Name !!');
                flag = false;
                $('#TRNSPRTNAME').focus();
            }
            else if ($('#TRNSPRTID').val() == "" || $('#TRNSPRTID').val() == "0") {
                alert('Please Select Transpoter Name !!');
                flag = false;
                $('#TRNSPRTNAME').focus();
            }
            else if ($('#VHLNO').val() == "") {
                alert('Please Enter Vehicle No !!');
                flag = false;
                $('#VHLNO').focus();
            }
            else if ($('#VHLMID').val() == "0" && $('#TRNSPRTID').val() == "19739") {
                alert('Please Check Vehicle No is updated in Vehicle Master!!');
                flag = false;
                $('#VHLNO').focus();
            }
            else if ($('#GPNRNO').val() == "") {
                alert('Please Enter PNR No !!');
                flag = false;
                $('#GPNRNO').focus();
            }

            else if ($('#VSLNAME').val() == "") {
                alert('Please Select Vessel Name !!');
                flag = false;
                $('#VSLNAME').focus();
            }
            else if ($('#VSLID').val() == "" || $('#VSLID').val() == "0") {
                alert('Please Select Vessel Name !!');
                flag = false;
                $('#VSLNAME').focus();
            }
            else if ($('#VOYNO').val() == "") {
                alert('Please Enter Voyage No !!');
                flag = false;
                $('#VOYNO').focus();
            }
            else if ($('#IGMNO').val() == "") {
                alert('Please Enter IGM No !!');
                flag = false;
                $('#IGMNO').focus();
            }
            else if ($('#GPLNO').val() == "") {
                alert('Please Enter Line No !!');
                flag = false;
                $('#GPLNO').focus();
            }
            else if ($('#IMPRTNAME').val() == "") {
                alert('Please Select Importer Name !!');
                flag = false;
                $('#IMPRTNAME').focus();
            }
            else if ($('#IMPRTID').val() == "" || $('#IMPRTID').val() == "0") {
                alert('Please Select Importer Name !!');
                flag = false;
                $('#IMPRTNAME').focus();
            }
            else if ($('#STMRNAME').val() == "") {
                alert('Please Select Steamer Name !!');
                flag = false;
                $('#STMRNAME').focus();
            }
            else if ($('#STMRID').val() == "" || $('#STMRID').val() == "0") {
                alert('Please Select Steamer Name !!');
                flag = false;
                $('#STMRNAME').focus();
            }
            else if ($('#CONTNRNO').val() == "") {
                alert('Please Enter Container No !!');
                flag = false;
                $('#CONTNRNO').focus();
            }
            else if ($('#CONTNRSID').val() == "") {
                alert('Please Select Size !!');
                flag = false;
                $('#CONTNRSID').focus();
            }
            else if ($('#CONTNRTID').val() == "") {
                alert('Please Select Type !!');
                flag = false;
                $('#CONTNRTID').focus();
            }
            else if ($('#GIISOCODE').val() == "") {
                alert('Please Enter ISO Code !!');
                flag = false;
                $('#GIISOCODE').focus();
            }
            else if ($('#LPSEALNO').val() == "") {
                alert('Please Enter L.Seal No !!');
                flag = false;
                $('#LPSEALNO').focus();
            }
            else if ($('#CSEALNO').val() == "") {
                alert('Please Enter C.Seal No !!');
                flag = false;
                $('#CSEALNO').focus();
            }
            else if ($('#PRDTGID').val() == "") {
                alert('Please Select Product Category !!');
                flag = false;
                $('#PRDTGID').focus();
            }
            else if ($('#PRDTDESC').val() == "") {
                alert('Please Select Product Description !!');
                flag = false;
                $('#PRDTDESC').focus();
            }
            else if (($('#GPWTYPE option:selected').val() == "1") && ($('#GPWGHT').val() == "" || $('#GPWGHT').val() == "0" || $('#GPWGHT').val() == "0.00" || $('#GPWGHT').val() == "0.000" || $('#GPWGHT').val() == "0.0000")) {
                alert('Please enter Weight !!');
                flag = false;
                $('#GPWGHT').focus();
            }
            else if ($('#GPPTYPE').val() == "") {
                alert('Please Select Port !!');
                flag = false;
                $('#GPPTYPE').focus();
            }
            else if ($('#GPMODEID').val() == "") {
                alert('Please Select GP Mode !!');
                flag = false;
                $('#GPMODEID').focus();
            }
            else if ($('#ROWID').val() == "") {
                alert('Please Select Row !!');
                flag = false;
                $('#ROWID').focus();
            }
            else if ($('#SLOTID').val() == "" || $('#SLOTID').val() == "0") {
                alert('Please Select Slot !!');
                flag = false;
                $('#SLOTID').focus();
            }
            else if ($('#GPSCNTYPE').val() == "1") {
                if ($('#GPSCNMTYPE').val() == "") {
                    alert('Please Select Scan Type !!');
                    flag = false;
                    $('#GPSCNMTYPE').focus();
                }
            }

            if (flag) {

                if ($("#BOEDATE").val() == "") { $("#BOEDATE").val("null"); }
                if ($("#IGMDATE").val() == "") { $("#IGMDATE").val("null"); }
                if ($("#GPWGHT").val() == "") { $("#GPWGHT").val("0"); }
                if ($("#GPEAMT").val() == "") { $("#GPEAMT").val("0"); }
                if ($("#GPAAMT").val() == "") { $("#GPAAMT").val("0"); }
                if ($("#SLOTID").val() == "") { $("#SLOTID").val("0"); }
                if ($("#CHAID").val() == "") { $("#CHAID").val("0"); }
                if ($("#BCHAID").val() == "") { $("#BCHAID").val("0"); }
                if ($("#CHANAME").val() == "") { $("#CHANAME").val("-"); }
                if ($("#BCHANAME").val() == "") { $("#BCHANAME").val("-"); }
                if ($("#EXPRTRID").val() == "") { $("#EXPRTRID").val("0"); }
                if ($("#EXPRTRNAME").val() == "") { $("#EXPRTRNAME").val("0"); }
                if ($("#UNITID").val() == "") { $("#UNITID").val("0"); }
                if ($("#BOENO").val() == "") { $("#BOENO").val("-"); }

                var gidate = $('.GIDATE').val();
                var gitime = $('.GITIME').val();
                var pidate = $('.GICCTLDATE').val();
                var pitime = $('.GICCTLTIME').val();

                if ((pidate != "" && pitime != "") && (pitime != "" && gitime != "")) {
                    var podate = Splitthedate($('.GICCTLDATE').val());
                    var gindate = Splitthedate($('.GIDATE').val());

                    var potime = Splitthetime($('.GICCTLTIME').val());
                    var gintime = Splitthetime($('.GITIME').val());

                    var Podatetime = podate + potime;
                    var GiDateTime = gindate + gintime;

                    //alert(podate);
                    //alert(gindate);
                    //if (gindate < podate) {
                    //    alert("Gate in date must be grater than Port date");
                    //    $('#GIDATE').focus();
                    //    flag = false;
                    //}


                    if (GiDateTime < Podatetime) {
                        alert("Gate in date must be grater than Port date");
                        $('#GIDATE').focus();
                        flag = false;
                    }
                }

                //if ((pitime != "" && gitime != "")) {

                //    //alert(potime);
                //    //alert(gintime);
                //    if (gintime < potime) {
                //        alert("Gate in Time must be grater than Port Time");
                //        $('#GITIME').focus();
                //        flag = false;
                //    }
                //}

                //if ((gidate != "" && gitime != "") && (pidate != "" && pitime != "")) {
                //    var gdt = gidate + " " + gitime;
                //    var pdt = pidate + " " + pitime;
                //    if (gdt >= pdt) {
                //        flag = true;
                //    }
                //    else {
                //        alert("Gate in date must be grater than Port date");
                //        $('#GIDATE').focus();
                //        flag = false;
                //    }

                //    //if ((gdt < pdt)) {
                //    //    alert("Gate in date must be grater than Port date");
                //    //    $('#GIDATE').focus();
                //    //    flag = false;
                //    //}
                //}

                if (flag) {
                    var r = confirm("Do you want to submit this record ?");

                    if (r == true) {
                        var tab = ($("#gateinform").serialize());
                        console.log(tab);
                        $("#btnsave").attr("disabled", "disabled");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("saveidata", "ImportGateIn")', // we are calling json method
                            data: tab,
                            success: function (data) {
                                var txtgit = $('#txtgity').val();
                                if (data == "saved") {
                                    if (txtgit == "RGateIn") {
                                        var returnurl = '@Url.Action("GIndex", "ImportRemoteGateIn")';
                                        window.location.href = returnurl;
                                        alert('Save Successfully');

                                        $('#VOYNO').val(''); $('#IGMNO').val('');
                                        $('#GPLNO').val(''); $('#CONTNRNO').val('');
                                        $("#btnsave").removeAttr("disabled", "disabled");
                                    }
                                    else if (txtgit == "GateIn") {
                                        var returnurl = '@Url.Action("Index", "ImportGateIn")';
                                        window.location.href = returnurl;
                                        alert('Save Successfully');
                                        $('#VOYNO').val(''); $('#IGMNO').val('');
                                        $('#GPLNO').val(''); $('#CONTNRNO').val('');
                                        $("#btnsave").removeAttr("disabled", "disabled");
                                    }                           
                                }
                                else {
                                    alert('Gatein Details exists');
                                    var returnurl = '@Url.Action("Form", "ImportGateIn")';
                                    window.location.href = returnurl;
                                    $("#btnsave").removeAttr("disabled", "disabled");
                                }
                            },
                            error: function (ex) {
                                //alert('Failed to save data ' + ex);
                            }
                        });
                    }
                }
            }
        });

        function DuplctContCheck() {
            // alert("call");
            var VOYNO = $("#VOYNO").val();
            var GPLNO = $("#GPLNO").val();
            var IGMNO = $("#IGMNO").val();
            var CONTNRNO = $("#CONTNRNO").val();
            var GiDate = $("GIDATE").val();
            base = window.location.origin;
            if (VOYNO != "" && GPLNO != "" && IGMNO != "" && CONTNRNO != "") {
                $.post(base + "/ImportGateIn/CONT_Duplicate_Check",
                    {
                        VOYNO: VOYNO, GPLNO: GPLNO, IGMNO: IGMNO, CONTNRNO: CONTNRNO, date: GiDate
                    },
                    function (data, status) {
                        // alert(data);
                        if (data == "Container number already exists") {
                            alert("Container number already exists for this IGMNO:" + IGMNO + ",Line No:" + GPLNO + ",Voyage No:" + VOYNO + "");
                            $("#CONTNRNO").val("");

                        }
                        else if (data == "DATE INCORRECT") {
                            alert("Please Check Container GateIn Date");
                            $("#CONTNRNO").val("");
                        }
                    });
            }
            return false;
        }

        $(document).ready(function () {
            $("#othertransdiv").hide();
            //$("#DRVNAME").focus();
            
            $('input[id$=GIDATE]').datepicker({
                dateFormat: 'dd/mm/yy',
                //dateFormat: 'yy-mm-dd',
                maxDate: new Date(),
                onClose: function (dateText, inst) {
                    $("#GIDATE").focus();
                }
            });

            $('input[id$=GICCTLDATE]').datepicker({
                dateFormat: 'dd/mm/yy',
                maxDate: new Date(),
                onClose: function (dateText, inst) {
                    $("#GICCTLDATE").focus();
                }
            });

            $('input[id$=IGMDATE]').datepicker({
                dateFormat: 'dd/mm/yy',
                maxDate: new Date(),
                onClose: function (dateText, inst) {
                    $("#IGMDATE").focus();
                }
            });

            $('input[id$=NEWDATE1]').datepicker({
                dateFormat: 'dd/mm/yy',
                maxDate: new Date(),
                onClose: function (dateText, inst) {
                    $("#NEWDATE1").focus();
                }
            });

            $('input[id$=NEWDATE2]').datepicker({
                dateFormat: 'dd/mm/yy',
                maxDate: new Date(),
                onClose: function (dateText, inst) {
                    $("#NEWDATE2").focus();
                }
            });

            $('.timepicker').datetimepicker({
                datepicker: false,
                format: 'H:i'
            });

            if ($("#RGIDID").val() != 0) {
                //$("#GICCTLDATE").attr('readonly', 'readonly');
                //$("#GICCTLDATE").attr('tabindex', '-1');
                //$("#GICCTLTIME").attr('readonly', 'readonly');
                //$("#GICCTLTIME").attr('tabindex', '-1');
                $("#GICCTLDATE").removeAttr('readonly', 'readonly');
                $("#GICCTLDATE").attr('tabindex', '1');
                $("#GICCTLTIME").removeAttr('readonly', 'readonly');
                $("#GICCTLTIME").attr('tabindex', '1');
                //alert("a");
                GetScanTypeChange();
            }
            else if ($("#GIDID").val() == 0 || $("#GIDID").val() == "") {
                $("#GICCTLDATE").removeAttr('readonly', 'readonly');
                $("#GICCTLTIME").removeAttr('readonly', 'readonly');
                $("#GICCTLTIME").val("")
                //alert("b");
            }


            function split(val) {
                return val.split(/,\s*/);
            }
            function extractLast(term) {
                return split(term).pop();
            }
            window.onbeforeunload = function () {
                $("input[type=submit]").attr("disabled", "disabled");
            };
            $("input:submit").on("click", function () {
                // alert("call");
                if ($("#gateinform").valid()) {
                    // alert("1call");
                    openModal();
                }
                else {
                    return false;
                }
            })

            $(".datepicker").removeAttr('GIDATE').removeClass('hasDatepicker');
            $(".datepicker").removeAttr('GICCTLDATE').removeClass('hasDatepicker');
            $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy' });
            $("#BOEDATE").datepicker({ dateFormat: 'dd/mm/yy', maxDate: '+1d' });
            $("#IGMDATE").datepicker({ dateFormat: 'dd/mm/yy', maxDate: '+1d' });

       //-----------------Cascading of ROW Id-----------//
            @*$("#ROWID").change(function () {
                $("#SLOTID").empty();
                id = $("#ROWID").val();
                $.ajax({
                    type: 'get',
                    url: '@Url.Action("GetSlot", "ImportGateIn")?id=' + id, //.....calling json method
                    dataType: 'json',
                    success: function (data) {
                        $.each(data, function (i, dataval) {
                            $("#SLOTID").append('<option>Please select a slot</option><option value="' + dataval.SLOTID + '">' + dataval.SLOTDESC + '</option>');
                        });
                    },
                    error: function (ex) {
                        alert('Failed to data ' + ex);
                    }
                });
                return false;
            });//End of Change event*@

            $(function () {

                //------------Autocomplete function-------------//
                add_autocomplete_Vessel($("#VSLNAME"), "VSLNAME,VSLID");
                //    add_autocomplete($("#VHLNO"), "VHLNO,TRNSPRTID,TRNSPRTNAME");
                add_autocomplete_transport($("#TRNSPRTNAME"), "TRNSPRTNAME,TRNSPRTID");
                add_autocomplete_Steamer($("#STMRNAME"), "STMRNAME,STMRID");
                add_autocomplete_Importer($("#IMPRTNAME"), "IMPRTNAME,IMPRTID");
                add_autocomplete($("#SLOTID"), "SLOTID,SLOTDESC");

                add_autocomplete_chaname($("#CHANAME"), "CHANAME,CHAID");
                add_autocomplete_vehicle($("#VHLNO"), "VHLMDESC,VHLMID");

                //End

                $(".datepicker").datepicker({
                    dateFormat: 'dd/mm/yy',
                    maxDate: new Date()
                });

                if ($("#GIDID").val() == "") {
                    $("#GIDID").val('0');
                }

                if ($("#GIDID").val() != "0") {
                    if ($(".Del_check").html() != "PROCEED") {
                        alert($(".Del_check").html());
                        var UserGroup = $('.txtGroup').val();
                        //alert(UserGroup);
                        if ((UserGroup == "SuperAdmin" || UserGroup == "Admin" || UserGroup == "GroupAdmin")) {
                            $(".btnsave").removeAttr("disabled", "disabled");
                        }
                        else {
                            $(".btnsave").attr("disabled", "disabled");
                        }
                        //$(".btnsave").attr("disabled", "disabled");
                        //$("#gateinform input:submit").attr("disabled", "disabled");
                    } else {
                        var UserGroup = $('.txtGroup').val();
                        //alert(UserGroup);
                        if ((UserGroup == "SuperAdmin" || UserGroup == "Admin" || UserGroup == "GroupAdmin")) {
                            $(".btnsave").removeAttr("disabled", "disabled");
                        }
                        else {
                            $(".btnsave").attr("disabled", "disabled");
                        }


                        //$("#gateinform input:submit").removeAttr("disabled", "disabled");
                    }
                }
                else {
                    // Set default date/time only if the fields are empty
                    var currentPortDate = $("#GICCTLDATE").val();
                    var currentPortTime = $("#GICCTLTIME").val();
                    var currentInTime = $("#GITIME").val();

                    if (!currentPortDate || !currentPortTime || !currentInTime) {
                        var dt = new Date();

                        var year = dt.getFullYear();
                        var month = (dt.getMonth() + 1).toString();
                        var day = dt.getDate().toString();

                        if (month < 10) month = "0" + month;
                        if (day < 10) day = "0" + day;

                        var date = day + '/' + month + '/' + year;

                        var hours = dt.getHours();
                        var minutes = dt.getMinutes();
                        var seconds = dt.getSeconds();

                        if (hours < 10) hours = "0" + hours;
                        if (minutes < 10) minutes = "0" + minutes;
                        if (seconds < 10) seconds = "0" + seconds;

                        var time = hours + ':' + minutes + ':' + seconds;

                        if (!currentPortDate) {
                            $("#GICCTLDATE").val(date);
                        }
                        if (!currentInTime) {
                            $("#GITIME").val(time);
                        }
                        if (!currentPortTime) {
                            $("#GICCTLTIME").val(time);
                        }
                    }
                }
                //$('.time').timepicker();
            });

           // AdminGrpChk();
        });

        //-----------container no check----------------------//

        $("#CONTNRNO").on("change", function () {
           DuplctContCheck();
            //var VOYNO = $("#VOYNO").val();
            //var GPLNO = $("#GPLNO").val();
            //var IGMNO = $("#IGMNO").val();
            //var CONTNRNO = $("#CONTNRNO").val();
            //base = window.location.origin;
            //$.post(base + "/GateInDetail/CONT_Duplicate_Check",
            //        {
            //            P_VOYNO: VOYNO, P_GPLNO: GPLNO, P_IGMNO: IGMNO, P_CONTNRNO: CONTNRNO
            //        },
            //       function (data, status) {
            //           if (data == "Container number already exists") {
            //               alert(data);
            //               $("#CONTNRNO").val("");
            //           }
            //       });
            //return false;
        });
        //----End---
        $("#ROWID").change(function () {
                $("#SLOTID").empty();
                id = $("#ROWID").val();
                $.ajax({
                    type: 'get',
                    url: '@Url.Action("GetSlot", "ImportGateIn")?id=' + id, //.....calling json method
                    dataType: 'json',
                    success: function (data) {
                        $("#SLOTID").append('<option value=0>Please select a slot</option>');
                        $.each(data, function (i, dataval) {
                            $("#SLOTID").append('<option value="' + dataval.SLOTID + '">' + dataval.SLOTDESC + '</option>');
                        });
                    },
                    error: function (ex) {
                        //alert('Failed to data ' + ex);
                    }
                });
                return false;
            });


        $("#IGMNO,#VOYNO,#GPLNO").on("change", function () {
            // $("#CONTNRNO").val("");
            //DuplctContCheck();
        });

        function split(val) {
            return val.split(/,\s*/)
        }
        function extractLast(term) {
            return split(term).pop()
        }

        $("#TRNSPRTNAME").on("blur", function () {
            var TRNSPRTNAME = $("#TRNSPRTNAME").val();
            var TRNSPRTID = $("#TRNSPRTID").val();
            //if (TRNSPRTID == "67554") {
            if (TRNSPRTID == 68812 || TRNSPRTID == 67554) {

                $("#VHLNO").val("");
                $("#GPNRNO").val("-");
                $("#VHLMID").val("0");
                $("#GTRNSPRTNAME").val("");
                $("#othertransdiv").show();
                $("#GTRNSPRTNAME").focus()
            }
            else if (TRNSPRTID == 19739) {
                $("#VHLNO").val("");
                $("#GPNRNO").val("-");
                $("#VHLMID").val("0");
                $("#GTRNSPRTNAME").val(TRNSPRTNAME);

                //alert($("#GTRNSPRTNAME").val());
                $("#othertransdiv").hide();
            }

            else {
                //alert("y")
                $("#GTRNSPRTNAME").val(TRNSPRTNAME);
                $("#othertransdiv").hide();
                //alert($("#GTRNSPRTNAME").val());
            }

        });

        $("#VHLNO").on("blur", function () {
            var VHLMID = $("#VHLMID").val();
            if (VHLMID == "" || VHLMID == "0") {
                VHLMID = 0;
            }
            var TRNSPRTNAME = $("#TRNSPRTNAME").val();
            var TRNSPRTID = $("#TRNSPRTID").val();
            if (TRNSPRTID == "19739") {
                if (TRNSPRTID > 0) {
                    var url = "/NonPnrGateIn/GetVehicle/" + TRNSPRTID + "-" + VHLMID;
                    //var url = "/NonPnrGateIn/GetVehicle/" + TRNSPRTID;
                    $.ajax({
                        url: url,
                        dataType: 'json',
                        async: false,
                        success: function (data) {
                            //console.log(data);
                            if (data.length > 0) {
                                //alert(data[0].VHLPNRNO);
                                $("#VHLMID").val(data[0].VHLMID);
                                $("#GPNRNO").val(data[0].VHLPNRNO);
                            }
                            else {
                                $("#VHLMID").val("0");
                                $("#GPNRNO").val("-");
                            }
                        }
                    });
                }

            }
            else {
                $("#VHLMID").val("0");
                $("#GPNRNO").val("-");
            }

            //----End of function
        });

        function add_autocomplete_transport($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };

            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 0: break;
                            default:
                                $("#" + value).val(""); break;
                        } count++;
                    })
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break
                        }
                        count++
                        $("#TRNSPRTID").val(ui.item.id);
                    });
                    //alert($("#TRNSPRTID").val());
                    //$("#VHLNO").empty();
                    id = $("#TRNSPRTID").val();
                    vid = $("#VHLNO").val();
                    // alert(id);
                    if (id == "19739" || id == "19740") {
                        //  alert(id);
                        @* $.ajax({
                            type: 'get',
                            url: '@Url.Action("GetVehicle", "NonPnrGateIn")?id=' + id, //.....calling json method
                            dataType: 'json',
                            success: function (data) {
                                if (data != "") {
                                    $(".VHL_DIV").html("<select class='form-control VHLNO' name='VHLNO' id='VHLNO' tabindex = '9'></select>")
                                    $.each(data, function (i, dataval) {
                                        $("#VHLNO").append('<option value="' + dataval.VHLMDESC + '">' + dataval.VHLMDESC + '</option>');
                                    });
                                    // $("#VHLNO").append('');
                                }
                            },
                            error: function (ex) {
                                alert('Failed to data ' + ex);
                            }
                        });*@

                    }
                    return false
                },
                change: function (event, ui) {
                    //debugger;
                    var opt = $(this).val();
                    var crntval = event.currentTarget.value;
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        url: $obj.data("autocomplete-url"),
                        data: "{'term':'" + crntval + "'}",
                        dataType: 'json',
                        success: function (data) {
                            //debugger;
                            console.log(data);
                            //alert(data);
                            if (data.length == 0) {
                                // $(event.currentTarget).val('');
                                alert('Select item from the list.');
                                $("#TRNSPRTNAME").focus();
                                $("#TRNSPRTID").val("0");
                            }
                            else { }
                        },
                        error: function (data) {
                            $(event.currentTarget).val('');
                            console.log('Error retrieving options.');
                        }
                    });
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }

        function add_autocomplete_Steamer($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };

            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 0: break;
                            default:
                                $("#" + value).val(""); break;
                        } count++;
                    })
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break
                        }
                        count++
                        $("#STMRID").val(ui.item.id);
                    });

                    return false
                },
                change: function (event, ui) {
                    //debugger;
                    var opt = $(this).val();
                    var crntval = event.currentTarget.value;
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        url: $obj.data("autocomplete-url"),
                        data: "{'term':'" + crntval + "'}",
                        dataType: 'json',
                        success: function (data) {
                            //debugger;
                            console.log(data);
                            if (data.length == 0) {
                                // $(event.currentTarget).val('');
                                alert('Select item from the list.');
                                $("#STMRNAME").focus();
                                $("#STMRID").val("0");
                            }
                        },
                        error: function (data) {
                            $(event.currentTarget).val('');
                            $("#STMRNAME").val('');
                            $("#STMRID").val("0");
                            console.log('Error retrieving options.');
                        }
                    });
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }

        function add_autocomplete_Importer($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };

            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 0: break;
                            default:
                                $("#" + value).val(""); break;
                        } count++;
                    })
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break
                        }
                        count++
                        $("#IMPRTID").val(ui.item.id);
                    });

                    return false
                },
                change: function (event, ui) {
                    //debugger;
                    var opt = $(this).val();
                    var crntval = event.currentTarget.value;
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        url: $obj.data("autocomplete-url"),
                        data: "{'term':'" + crntval + "'}",
                        dataType: 'json',
                        success: function (data) {
                            //debugger;
                            console.log(data);
                            //alert(data);
                            if (data.length == 0) {
                                // $(event.currentTarget).val('');
                                alert('Select item from the list.');
                                $("#IMPRTNAME").focus();
                                $("#IMPRTID").val("0");
                            }
                            else { }
                        },
                        error: function (data) {
                            $(event.currentTarget).val('');
                            $("#IMPRTNAME").val('');
                            $("#IMPRTID").val("0");
                            console.log('Error retrieving options.');
                        }
                    });
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }

        function add_autocomplete_chaname($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };
            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        max: 10,
                        scrollable: true,
                        data: {
                            term: request.term
                        },
                        success: function (data) {

                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;// + " (" + item['WRDCODE'] + ")";
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                        case 6:
                                            jsonArg.xparam4 = data;
                                            break


                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {

                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break
                            case 6:
                                $("#" + value).val(ui.item.xparam4);
                                break
                        }
                        count++
                    });
                    $("#CHAID").val(ui.item.id);
                    return false
                },
                change: function (event, ui) {
                    //debugger;
                    var opt = $(this).val();
                    var crntval = event.currentTarget.value;
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        url: $obj.data("autocomplete-url"),
                        data: "{'term':'" + crntval + "'}",
                        dataType: 'json',
                        success: function (data) {
                            //debugger;
                            if (data.length == 0) {
                                //$(event.currentTarget).val('');
                                alert('Select Items from the list.');
                                $("#CHANAME").focus();
                                $("#CHAID").val('0');
                            }
                        },
                        error: function (data) {
                            $(event.currentTarget).val('');
                            $("#CHANAME").val('');
                            $("#CHAID").val('0');
                            console.log('Error retrieving options.');
                        }
                    });
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }

        function add_autocomplete_vehicle($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };

            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        data: {
                            term: request.term + ";" + $("#TRNSPRTID").val()
                            //term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 0: break;
                            default:
                                $("#" + value).val(""); break;
                        } count++;
                    })
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break
                        }
                        count++
                    });

                    return false
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }

        function add_autocomplete_Vessel($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };
            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        max: 10,
                        scrollable: true,
                        data: {
                            term: request.term
                        },
                        success: function (data) {

                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;// + " (" + item['WRDCODE'] + ")";
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                        case 6:
                                            jsonArg.xparam4 = data;
                                            break


                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {

                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break
                            case 6:
                                $("#" + value).val(ui.item.xparam4);
                                break
                        }
                        count++
                    });
                    $("#VSLID").val(ui.item.id);
                    return false
                },
                change: function (event, ui) {
                    //debugger;
                    var opt = $(this).val();
                    var crntval = event.currentTarget.value;
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        url: $obj.data("autocomplete-url"),
                        data: "{'term':'" + crntval + "'}",
                        dataType: 'json',
                        success: function (data) {
                            //debugger;
                            if (data.length == 0) {
                                //$(event.currentTarget).val('');
                                alert('Select Items from the list.');
                                $("#VSLNAME").focus();
                                $("#VSLID").val('0');
                            }
                        },
                        error: function (data) {
                            $(event.currentTarget).val('');
                            $("#VSLNAME").val('');
                            $("#VSLID").val('0');
                            console.log('Error retrieving options.');
                        }
                    });
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }
        //-----------Escort check------------
        function escord() {
            //alert("aa");
            temp3 = $("#TRNSPRTID").val();
            if (temp3 == "0") {
                closeModal();
                alert("Please Select Transporter...!");
                $(".TRNSPRTNAME").focus();
                return false;
            }
            if (temp3 == "") {
                closeModal();
                alert("Please Select Transporter...!");
                $(".TRNSPRTNAME").focus();
                return false;
            }
            vtemp3 = $("#VHLNO").val();
            if (vtemp3 == "") {
                closeModal();
                alert("Please Enter Vehicle No....!");
                $(".VHLNO").focus();
                return false;
            }
            temp4 = $("#VSLID").val();
            if (temp4 == "0") {
                closeModal();
                alert("Please Select Vessel");
                $(".VSLNAME").focus();
                return false;
            }
            temp1 = $("#IMPRTID").val();
            if (temp1 == "0") {
                closeModal();
                alert("Please Select Importer");
                $(".IMPRTNAME").focus();
                return false;
            }
            temp2 = $("#STMRID").val();
            if (temp2 == "0") {
                closeModal();
                alert("Please Select Streamer");
                $(".STMRNAME").focus();
                return false;
            }
            var vno = $("#GPETYPE").val();
            var amt = $("#GPEAMT").val();
            if (vno == 1 && amt == 0) {
                closeModal();
                alert("Please Enter Escord Amount...!");
                $(".GPEAMT").focus();
                return false;
            }
            else {
                return true;
            }
            var wgt = $("#GPWTYPE").val();
            var wgamt = $("#GPGWGHT").val();
            if (wgt == 1 && wgamt == "") {
                closeModal();
                alert("Please Enter Weight...!");
                $(".GPGWGHT").focus();
                return false;
            }
            else {
                return true;
            }
        }

        function AdminGrpChk()
        {
            admgrpchk = $("#UsrAdmGrpChk").val();
            if (admgrpchk == "N") {
                $("#GIDATE").datepicker("option", "disabled", true);
                $("#GITIME").datepicker("option", "disabled", true);
                //$("#GITIME").timepicker("option", "disabled", true);
                $("#GIDATE").attr('readonly', true);
                $("#GITIME").attr('readonly', true);
                $("#GICCTLDATE ").focus();
            }       
        }

        function GetScanTypeChange() {


            var id1 = $(".GPSCNTYPE option:selected").val();
            //alert(id1);
            if (id1.trim() == "" || eval(id1) == 0) {
                document.getElementById("sc_credit").style.display = "none";
            }
            else {
                document.getElementById("sc_credit").style.display = "block";
            }

            //if (id2.trim() == "" || eval(id2) == 2) {
            //    document.getElementById("sc_credit").style.display = "none";
            //    $(".QM_CREDIT_PERIOD").val("0");
            //}
            //else {
            //    document.getElementById("sc_credit").style.display = "block";
            //}


        }

        // API Request Button Click Handler
        $(document).ready(function () {
            $("#btnApiRequest").click(function () {
                var containerNumber = $("#CONTNRNO").val();
                
                if (!containerNumber || containerNumber.trim() === "") {
                    alert("Please enter a Container Number first.");
                    $("#CONTNRNO").focus();
                    return;
                }

                // Show modal and reset content
                $("#modalContainerNumber").text(containerNumber.trim());
                $("#apiRequestModal").modal("show");
                $("#apiLoading").show();
                $("#apiError").hide();
                $("#apiContent").hide();
                $("#apiErrorMessage").text("");
                $("#apiDataDisplay").text(""); // Clear previous data

                // Call API
                var apiUrl = "@Url.Action("CallULIPLDBAPI", "ImportRemoteGateIn")";
                if (!apiUrl || apiUrl === "") {
                    apiUrl = "/ImportRemoteGateIn/CallULIPLDBAPI";
                }

                var requestData = {
                    containerNumber: containerNumber.trim()
                };

                $.ajax({
                    url: apiUrl,
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(requestData),
                    dataType: "text",
                    success: function (response) {
                        console.log("API Response received:", response);
                        console.log("Response type:", typeof response);
                        console.log("Response length:", response ? response.length : 0);
                        
                        $("#apiLoading").hide();
                        
                        // Check if response is empty
                        if (!response || response.trim() === "") {
                            $("#apiErrorMessage").text("API returned empty response.");
                            $("#apiError").show();
                            return;
                        }
                        
                        try {
                            // Parse the JSON string response
                            var jsonResponse;
                            if (typeof response === 'string') {
                                jsonResponse = JSON.parse(response);
                            } else {
                                jsonResponse = response;
                            }
                            
                            console.log("Parsed JSON:", jsonResponse);
                            
                            // Check if response has any data
                            if (!jsonResponse || (typeof jsonResponse === 'object' && Object.keys(jsonResponse).length === 0)) {
                                $("#apiErrorMessage").text("API returned an empty response object.");
                                $("#apiError").show();
                                return;
                            }
                            
                            // Format and display the response with proper indentation
                            var formattedData = JSON.stringify(jsonResponse, null, 2);
                            
                            // Check if formatted data is empty
                            if (!formattedData || formattedData.trim() === "" || formattedData === "{}" || formattedData === "[]") {
                                $("#apiErrorMessage").text("No data to display. Response: " + formattedData);
                                $("#apiError").show();
                                return;
                            }
                            
                            console.log("Formatted data length:", formattedData.length);
                            console.log("First 200 chars:", formattedData.substring(0, 200));
                            
                            // Display the formatted JSON - using both text() and html() as fallback
                            var $display = $("#apiDataDisplay");
                            $display.text(formattedData);
                            
                            // Verify the content was set
                            var displayContent = $display.text();
                            if (!displayContent || displayContent.trim() === "") {
                                // Fallback: try using html with escaped content
                                $display.html($("<div>").text(formattedData).html());
                                displayContent = $display.text();
                            }
                            
                            // Force show the content div
                            $("#apiContent").css({
                                "display": "block",
                                "visibility": "visible"
                            });
                            
                            console.log("Content set in display element. Length:", displayContent ? displayContent.length : 0);
                            console.log("First 100 chars of displayed content:", displayContent ? displayContent.substring(0, 100) : "EMPTY");
                            console.log("Content div visible:", $("#apiContent").is(":visible"));
                            console.log("Content div display style:", $("#apiContent").css("display"));
                            
                            if (!displayContent || displayContent.trim() === "") {
                                $("#apiErrorMessage").text("Response received but could not be displayed. Raw response length: " + (response ? response.length : 0));
                                $("#apiError").show();
                                $("#apiContent").hide();
                            }
                        } catch (e) {
                            console.error("Error parsing JSON:", e);
                            console.error("Raw response:", response);
                            
                            // If parsing fails, display raw response
                            if (response && response.trim() !== "") {
                                $("#apiDataDisplay").text(response);
                                $("#apiContent").show();
                            } else {
                                $("#apiErrorMessage").text("Failed to parse API response: " + e.message);
                                $("#apiError").show();
                            }
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("API Error:", error);
                        console.error("Status:", status);
                        console.error("XHR:", xhr);
                        console.error("Response Text:", xhr.responseText);
                        
                        $("#apiLoading").hide();
                        var errorMessage = "Failed to fetch API data.";
                        
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        } else if (xhr.responseText) {
                            try {
                                var errorResponse = JSON.parse(xhr.responseText);
                                if (errorResponse.message) {
                                    errorMessage = errorResponse.message;
                                } else if (errorResponse.error) {
                                    errorMessage = errorResponse.error;
                                } else {
                                    errorMessage = xhr.responseText;
                                }
                            } catch (e) {
                                // If it's not JSON, show the raw response
                                if (xhr.responseText && xhr.responseText.trim() !== "") {
                                    errorMessage = xhr.responseText;
                                } else {
                                    errorMessage = error || "Unknown error occurred.";
                                }
                            }
                        } else {
                            errorMessage = error || "Unknown error occurred. Status: " + status;
                        }
                        
                        $("#apiErrorMessage").text(errorMessage);
                        $("#apiError").show();
                    }
                });
            });
        });
    </script>
    @*@Scripts.Render("~/bundles/jqueryval")*@
}


